<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Production Tech Documentation Platform</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0a0a0a;
      color: white;
      overflow-x: hidden;
    }

    .glow-cyan {
      box-shadow: 0 0 40px rgba(0, 217, 255, 0.3);
    }

    .glow-item {
      transition: all 0.3s ease;
    }

    .glow-item:hover {
      transform: translateY(-2px);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }

    .grid-bg {
      background-image: 
        linear-gradient(rgba(0, 217, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 217, 255, 0.03) 1px, transparent 1px);
      background-size: 20px 20px;
    }

    input, select, textarea {
      background: #2a2a2a;
      border: 1px solid rgba(0, 217, 255, 0.3);
      color: white;
      padding: 0.5rem;
      border-radius: 0.375rem;
      font-family: monospace;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #00d9ff;
    }

    button {
      cursor: pointer;
      transition: all 0.2s ease;
    }

    button:hover {
      transform: translateY(-1px);
    }

    .toast {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: #1a1a1a;
      border: 2px solid #00ff88;
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 0 30px rgba(0, 255, 136, 0.4);
      z-index: 100;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
    }

    .login-box {
      background: #1a1a1a;
      border: 2px solid #00d9ff;
      border-radius: 1rem;
      padding: 3rem;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 0 60px rgba(0, 217, 255, 0.3);
    }

    .spinner {
      border: 3px solid rgba(0, 217, 255, 0.1);
      border-top: 3px solid #00d9ff;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 0.5rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { Lock, User, AlertCircle } = lucide;

    // ==================== API CONFIGURATION ====================
    const API_BASE_URL = 'https://production-docs-backend-production.up.railway.app/api';
    
    // ==================== API HELPER FUNCTIONS ====================
    const getAuthToken = () => localStorage.getItem('auth_token');
    const setAuthToken = (token) => localStorage.setItem('auth_token', token);
    const removeAuthToken = () => localStorage.removeItem('auth_token');
    
    const apiRequest = async (endpoint, options = {}) => {
      const token = getAuthToken();
      const headers = {
        'Content-Type': 'application/json',
        ...options.headers,
      };
      
      if (token) {
        headers['Authorization'] = `Bearer ${token}`;
      }
      
      try {
        console.log(`API Request: ${endpoint}`, options);
        const response = await fetch(`${API_BASE_URL}${endpoint}`, {
          ...options,
          headers,
        });
        
        console.log(`API Response (${endpoint}):`, response.status, response.statusText);
        
        const data = await response.json();
        console.log(`API Data (${endpoint}):`, data);
        
        if (!response.ok) {
          throw new Error(data.error || `API request failed: ${response.status}`);
        }
        
        return data;
      } catch (error) {
        console.error('API Error:', error);
        throw error;
      }
    };

    // ==================== LOGIN COMPONENT ====================
    const LoginPage = ({ onLoginSuccess }) => {
      const [email, setEmail] = useState('admin@venue.com');
      const [password, setPassword] = useState('admin123');
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');

      const handleLogin = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);

        try {
          const data = await apiRequest('/auth/login', {
            method: 'POST',
            body: JSON.stringify({ email, password }),
          });

          if (data.success) {
            setAuthToken(data.data.token);
            onLoginSuccess(data.data.user);
          }
        } catch (err) {
          setError(err.message || 'Login failed. Please check your credentials.');
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="login-container">
          <div className="login-box fade-in">
            <div style={{ textAlign: 'center', marginBottom: '2rem' }}>
              <div style={{ 
                fontSize: '3rem', 
                marginBottom: '1rem',
                background: 'linear-gradient(135deg, #00d9ff 0%, #00ff88 100%)',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent',
                fontWeight: 'bold'
              }}>
                PRODUCTION DOCS
              </div>
              <div style={{ 
                fontSize: '0.9rem', 
                color: 'rgba(255,255,255,0.6)',
                fontFamily: 'monospace',
                letterSpacing: '2px'
              }}>
                TECHNICAL DOCUMENTATION PLATFORM
              </div>
            </div>

            <form onSubmit={handleLogin} style={{ marginTop: '2rem' }}>
              <div style={{ marginBottom: '1.5rem' }}>
                <label style={{ 
                  display: 'block', 
                  marginBottom: '0.5rem',
                  color: '#00d9ff',
                  fontSize: '0.9rem',
                  fontWeight: '500'
                }}>
                  Email
                </label>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  required
                  style={{ width: '100%', padding: '0.75rem' }}
                  placeholder="Enter your email"
                />
              </div>

              <div style={{ marginBottom: '1.5rem' }}>
                <label style={{ 
                  display: 'block', 
                  marginBottom: '0.5rem',
                  color: '#00d9ff',
                  fontSize: '0.9rem',
                  fontWeight: '500'
                }}>
                  Password
                </label>
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  required
                  style={{ width: '100%', padding: '0.75rem' }}
                  placeholder="Enter your password"
                />
              </div>

              {error && (
                <div style={{
                  background: 'rgba(255, 0, 85, 0.1)',
                  border: '1px solid #ff0055',
                  borderRadius: '0.5rem',
                  padding: '0.75rem',
                  marginBottom: '1.5rem',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '0.5rem'
                }}>
                  <AlertCircle size={16} color="#ff0055" />
                  <span style={{ fontSize: '0.9rem', color: '#ff0055' }}>{error}</span>
                </div>
              )}

              <button
                type="submit"
                disabled={loading}
                style={{
                  width: '100%',
                  padding: '0.75rem',
                  background: 'linear-gradient(135deg, #00d9ff 0%, #00ff88 100%)',
                  border: 'none',
                  borderRadius: '0.5rem',
                  color: '#0a0a0a',
                  fontWeight: 'bold',
                  fontSize: '1rem',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  opacity: loading ? 0.7 : 1,
                  cursor: loading ? 'not-allowed' : 'pointer'
                }}
              >
                {loading ? (
                  <>
                    <span className="spinner" />
                    Logging in...
                  </>
                ) : (
                  'LOGIN'
                )}
              </button>
            </form>

            <div style={{ 
              marginTop: '2rem', 
              textAlign: 'center',
              fontSize: '0.85rem',
              color: 'rgba(255,255,255,0.5)',
              fontFamily: 'monospace'
            }}>
              <div>Default credentials:</div>
              <div style={{ marginTop: '0.5rem', color: '#00d9ff' }}>
                admin@venue.com / admin123
              </div>
            </div>
          </div>
        </div>
      );
    };

    // ==================== CREATE/EDIT DOCUMENT FORM ====================
    const DocumentForm = ({ document, onSave, onCancel }) => {
      const [formData, setFormData] = useState({
        title: document?.title || '',
        description: document?.description || '',
        category_id: document?.category_id || 'audio',
        document_type_id: document?.document_type_id || 'procedure',
        status: document?.status || 'draft'
      });
      const [saving, setSaving] = useState(false);
      const isEditing = !!document;

      const handleSubmit = async (e) => {
        e.preventDefault();
        setSaving(true);
        await onSave(formData);
        setSaving(false);
      };

      return (
        <form onSubmit={handleSubmit}>
          <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
            <div>
              <label style={{ 
                display: 'block', 
                marginBottom: '0.5rem', 
                color: '#00d9ff', 
                fontSize: '0.85rem',
                fontWeight: '500'
              }}>
                TITLE *
              </label>
              <input
                type="text"
                value={formData.title}
                onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                required
                style={{ width: '100%' }}
                placeholder="Enter document title"
              />
            </div>

            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
              <div>
                <label style={{ 
                  display: 'block', 
                  marginBottom: '0.5rem', 
                  color: '#00d9ff', 
                  fontSize: '0.85rem',
                  fontWeight: '500'
                }}>
                  CATEGORY
                </label>
                <select
                  value={formData.category_id}
                  onChange={(e) => setFormData({ ...formData, category_id: e.target.value })}
                  style={{ width: '100%' }}
                >
                  <option value="audio">Audio</option>
                  <option value="video">Video</option>
                  <option value="lighting">Lighting</option>
                  <option value="network">Network</option>
                </select>
              </div>

              <div>
                <label style={{ 
                  display: 'block', 
                  marginBottom: '0.5rem', 
                  color: '#00d9ff', 
                  fontSize: '0.85rem',
                  fontWeight: '500'
                }}>
                  TYPE
                </label>
                <select
                  value={formData.document_type_id}
                  onChange={(e) => setFormData({ ...formData, document_type_id: e.target.value })}
                  style={{ width: '100%' }}
                >
                  <option value="procedure">Procedure</option>
                  <option value="signal-flow">Signal Flow</option>
                  <option value="topology">Topology</option>
                  <option value="patching">Patching</option>
                  <option value="troubleshooting">Troubleshooting</option>
                </select>
              </div>
            </div>

            <div>
              <label style={{ 
                display: 'block', 
                marginBottom: '0.5rem', 
                color: '#00d9ff', 
                fontSize: '0.85rem',
                fontWeight: '500'
              }}>
                DESCRIPTION *
              </label>
              <textarea
                value={formData.description}
                onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                required
                rows="8"
                style={{ width: '100%', resize: 'vertical' }}
                placeholder="Enter document description..."
              />
            </div>

            <div>
              <label style={{ 
                display: 'block', 
                marginBottom: '0.5rem', 
                color: '#00d9ff', 
                fontSize: '0.85rem',
                fontWeight: '500'
              }}>
                STATUS
              </label>
              <select
                value={formData.status}
                onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                style={{ width: '100%' }}
              >
                <option value="draft">Draft</option>
                <option value="published">Published</option>
              </select>
            </div>

            <div style={{ display: 'flex', gap: '1rem', marginTop: '1rem' }}>
              <button
                type="submit"
                disabled={saving}
                style={{
                  flex: 1,
                  padding: '0.75rem',
                  background: saving ? '#666' : 'linear-gradient(135deg, #00d9ff 0%, #00ff88 100%)',
                  borderRadius: '0.375rem',
                  border: 'none',
                  color: '#0a0a0a',
                  fontWeight: 'bold',
                  cursor: saving ? 'not-allowed' : 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  gap: '0.5rem'
                }}
              >
                {saving ? (
                  <>
                    <span className="spinner" style={{ width: '16px', height: '16px', borderTopColor: '#0a0a0a' }} />
                    SAVING...
                  </>
                ) : (
                  isEditing ? 'UPDATE DOCUMENT' : 'SAVE DOCUMENT'
                )}
              </button>
              <button
                type="button"
                onClick={onCancel}
                style={{
                  padding: '0.75rem 1.5rem',
                  background: 'transparent',
                  border: '1px solid rgba(255, 255, 255, 0.2)',
                  borderRadius: '0.375rem',
                  color: 'white',
                  cursor: 'pointer'
                }}
              >
                CANCEL
              </button>
            </div>
          </div>
        </form>
      );
    };

    // ==================== MAIN APP COMPONENT ====================
    const MainApp = ({ user, onLogout }) => {
      const [documents, setDocuments] = useState([]);
      const [equipment, setEquipment] = useState([]);
      const [loading, setLoading] = useState(true);
      const [toast, setToast] = useState(null);
      const [showCreateDocModal, setShowCreateDocModal] = useState(false);
      const [editingDocument, setEditingDocument] = useState(null);

      // Load initial data
      useEffect(() => {
        loadData();
      }, []);

      const loadData = async () => {
        try {
          setLoading(true);
          console.log('Loading data...');
          
          // Load documents
          const docsData = await apiRequest('/documents');
          console.log('Documents response:', docsData);
          if (docsData.success && docsData.data) {
            // Handle nested structure - documents are in data.documents
            const docs = docsData.data.documents || docsData.data;
            setDocuments(Array.isArray(docs) ? docs : []);
            console.log('Set documents:', docs);
          } else {
            setDocuments([]);
          }
          
          // Load equipment
          const equipData = await apiRequest('/equipment');
          console.log('Equipment response:', equipData);
          if (equipData.success && equipData.data) {
            // Handle nested structure if equipment uses same pattern
            const equip = equipData.data.equipment || equipData.data;
            setEquipment(Array.isArray(equip) ? equip : []);
            console.log('Set equipment:', equip);
          } else {
            setEquipment([]);
          }
          
          console.log('Data loaded successfully');
        } catch (error) {
          console.error('Error loading data:', error);
          // Set empty arrays on error so the UI can still render
          setDocuments([]);
          setEquipment([]);
          showToast('Error loading data: ' + error.message, 'error');
        } finally {
          setLoading(false);
        }
      };

      const showToast = (message, type = 'success') => {
        setToast({ message, type });
        setTimeout(() => setToast(null), 3000);
      };

      const handleCreateDocument = async (formData) => {
        try {
          console.log('Sending document data:', formData);
          const result = await apiRequest('/documents', {
            method: 'POST',
            body: JSON.stringify(formData)
          });
          
          console.log('Create document result:', result);
          if (result.success) {
            await loadData();
            setShowCreateDocModal(false);
            showToast('Document created successfully!');
          }
        } catch (error) {
          console.error('Create document error:', error);
          showToast('Error creating document: ' + error.message, 'error');
        }
      };

      const handleUpdateDocument = async (id, formData) => {
        try {
          console.log('Updating document:', id, formData);
          const result = await apiRequest(`/documents/${id}`, {
            method: 'PUT',
            body: JSON.stringify(formData)
          });
          
          console.log('Update document result:', result);
          if (result.success) {
            await loadData();
            setEditingDocument(null);
            showToast('Document updated successfully!');
          }
        } catch (error) {
          console.error('Update document error:', error);
          showToast('Error updating document: ' + error.message, 'error');
        }
      };

      const handleLogout = () => {
        removeAuthToken();
        onLogout();
      };

      if (loading) {
        console.log('MainApp: Still loading...');
        return (
          <div style={{
            minHeight: '100vh',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            flexDirection: 'column',
            gap: '1rem'
          }}>
            <div className="spinner" style={{ width: '48px', height: '48px' }} />
            <div style={{ color: '#00d9ff', fontFamily: 'monospace' }}>
              Loading platform...
            </div>
          </div>
        );
      }

      console.log('MainApp: Rendering dashboard', { documents, equipment, user });

      return (
        <div style={{ padding: '2rem' }}>
          {/* Header */}
          <div style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: '2rem',
            padding: '1rem',
            background: '#1a1a1a',
            border: '2px solid #00d9ff',
            borderRadius: '0.5rem'
          }}>
            <div>
              <h1 style={{ 
                fontSize: '1.5rem',
                background: 'linear-gradient(135deg, #00d9ff 0%, #00ff88 100%)',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent'
              }}>
                Production Documentation Platform
              </h1>
              <div style={{ 
                fontSize: '0.9rem',
                color: 'rgba(255,255,255,0.6)',
                marginTop: '0.25rem'
              }}>
                Welcome, {user.fullName || user.email}
              </div>
            </div>
            
            <button
              onClick={handleLogout}
              style={{
                padding: '0.5rem 1rem',
                background: 'rgba(255, 0, 85, 0.2)',
                border: '1px solid #ff0055',
                borderRadius: '0.375rem',
                color: '#ff0055',
                fontWeight: '500'
              }}
            >
              Logout
            </button>
          </div>

          {/* Dashboard Stats */}
          <div style={{
            display: 'grid',
            gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
            gap: '1rem',
            marginBottom: '2rem'
          }}>
            <div style={{
              background: '#1a1a1a',
              border: '2px solid #00d9ff',
              borderRadius: '0.5rem',
              padding: '1.5rem'
            }}>
              <div style={{ fontSize: '2rem', color: '#00d9ff', fontWeight: 'bold' }}>
                {documents.length}
              </div>
              <div style={{ color: 'rgba(255,255,255,0.6)', marginTop: '0.5rem' }}>
                Total Documents
              </div>
            </div>

            <div style={{
              background: '#1a1a1a',
              border: '2px solid #00ff88',
              borderRadius: '0.5rem',
              padding: '1.5rem'
            }}>
              <div style={{ fontSize: '2rem', color: '#00ff88', fontWeight: 'bold' }}>
                {equipment.length}
              </div>
              <div style={{ color: 'rgba(255,255,255,0.6)', marginTop: '0.5rem' }}>
                Equipment Items
              </div>
            </div>

            <div style={{
              background: '#1a1a1a',
              border: '2px solid #ffea00',
              borderRadius: '0.5rem',
              padding: '1.5rem'
            }}>
              <div style={{ fontSize: '2rem', color: '#ffea00', fontWeight: 'bold' }}>
                {equipment.filter(e => e.status === 'operational').length}
              </div>
              <div style={{ color: 'rgba(255,255,255,0.6)', marginTop: '0.5rem' }}>
                Operational
              </div>
            </div>
          </div>

          {/* Recent Documents */}
          <div style={{
            background: '#1a1a1a',
            border: '2px solid #00d9ff',
            borderRadius: '0.5rem',
            padding: '1.5rem',
            marginBottom: '2rem'
          }}>
            <div style={{
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
              marginBottom: '1rem'
            }}>
              <h2 style={{ color: '#00d9ff' }}>
                Recent Documents
              </h2>
              <button
                onClick={() => setShowCreateDocModal(true)}
                style={{
                  padding: '0.5rem 1rem',
                  background: 'linear-gradient(135deg, #00d9ff 0%, #00ff88 100%)',
                  borderRadius: '0.375rem',
                  color: '#0a0a0a',
                  fontWeight: 'bold',
                  fontSize: '0.85rem',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '0.5rem',
                  border: 'none'
                }}
              >
                + NEW DOCUMENT
              </button>
            </div>
            {documents.length === 0 ? (
              <div style={{ 
                textAlign: 'center', 
                padding: '2rem',
                color: 'rgba(255,255,255,0.5)'
              }}>
                No documents yet. Create your first document to get started!
              </div>
            ) : (
              <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                {documents.slice(0, 5).map(doc => (
                  <div
                    key={doc.id}
                    style={{
                      padding: '1rem',
                      background: '#2a2a2a',
                      border: '1px solid rgba(0, 217, 255, 0.3)',
                      borderRadius: '0.375rem',
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center'
                    }}
                  >
                    <div style={{ flex: 1 }}>
                      <div style={{ fontWeight: '500' }}>{doc.title}</div>
                      <div style={{ 
                        fontSize: '0.85rem',
                        color: 'rgba(255,255,255,0.6)',
                        marginTop: '0.25rem'
                      }}>
                        {doc.category_id} • {new Date(doc.created_at).toLocaleDateString()}
                      </div>
                    </div>
                    <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                      <div style={{
                        padding: '0.25rem 0.75rem',
                        background: doc.status === 'published' ? 'rgba(0, 255, 136, 0.2)' : 'rgba(255, 234, 0, 0.2)',
                        border: `1px solid ${doc.status === 'published' ? '#00ff88' : '#ffea00'}`,
                        borderRadius: '0.25rem',
                        fontSize: '0.75rem',
                        color: doc.status === 'published' ? '#00ff88' : '#ffea00',
                        textTransform: 'uppercase'
                      }}>
                        {doc.status}
                      </div>
                      <button
                        onClick={() => setEditingDocument(doc)}
                        style={{
                          padding: '0.5rem 0.75rem',
                          background: 'rgba(0, 217, 255, 0.1)',
                          border: '1px solid #00d9ff',
                          borderRadius: '0.375rem',
                          color: '#00d9ff',
                          fontSize: '0.75rem',
                          cursor: 'pointer',
                          fontWeight: '500'
                        }}
                      >
                        EDIT
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Equipment List */}
          <div style={{
            background: '#1a1a1a',
            border: '2px solid #00ff88',
            borderRadius: '0.5rem',
            padding: '1.5rem'
          }}>
            <h2 style={{ color: '#00ff88', marginBottom: '1rem' }}>
              Equipment Inventory
            </h2>
            {equipment.length === 0 ? (
              <div style={{ 
                textAlign: 'center', 
                padding: '2rem',
                color: 'rgba(255,255,255,0.5)'
              }}>
                No equipment registered yet. Add your first equipment item!
              </div>
            ) : (
              <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                {equipment.slice(0, 5).map(item => (
                  <div
                    key={item.id}
                    style={{
                      padding: '1rem',
                      background: '#2a2a2a',
                      border: '1px solid rgba(0, 255, 136, 0.3)',
                      borderRadius: '0.375rem',
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center'
                    }}
                  >
                    <div>
                      <div style={{ fontWeight: '500' }}>{item.name}</div>
                      <div style={{ 
                        fontSize: '0.85rem',
                        color: 'rgba(255,255,255,0.6)',
                        marginTop: '0.25rem'
                      }}>
                        {item.manufacturer} • {item.category}
                      </div>
                    </div>
                    <div style={{
                      padding: '0.25rem 0.75rem',
                      background: 
                        item.status === 'operational' ? 'rgba(0, 255, 136, 0.2)' :
                        item.status === 'maintenance' ? 'rgba(255, 234, 0, 0.2)' :
                        'rgba(255, 0, 85, 0.2)',
                      border: `1px solid ${
                        item.status === 'operational' ? '#00ff88' :
                        item.status === 'maintenance' ? '#ffea00' :
                        '#ff0055'
                      }`,
                      borderRadius: '0.25rem',
                      fontSize: '0.85rem',
                      color: 
                        item.status === 'operational' ? '#00ff88' :
                        item.status === 'maintenance' ? '#ffea00' :
                        '#ff0055'
                    }}>
                      {item.status}
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Create Document Modal */}
          {showCreateDocModal && (
            <div 
              style={{
                position: 'fixed',
                inset: 0,
                background: 'rgba(0, 0, 0, 0.85)',
                backdropFilter: 'blur(4px)',
                zIndex: 50,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '1rem'
              }}
              onClick={() => setShowCreateDocModal(false)}
            >
              <div 
                style={{
                  background: '#1a1a1a',
                  border: '2px solid #00d9ff',
                  borderRadius: '0.5rem',
                  maxWidth: '600px',
                  width: '100%',
                  maxHeight: '90vh',
                  overflow: 'auto',
                  boxShadow: '0 0 60px rgba(0, 217, 255, 0.4)'
                }}
                onClick={(e) => e.stopPropagation()}
              >
                <div style={{
                  padding: '1.5rem',
                  borderBottom: '1px solid rgba(0, 217, 255, 0.3)',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center'
                }}>
                  <h2 style={{ color: '#00d9ff', fontSize: '1.25rem' }}>CREATE NEW DOCUMENT</h2>
                  <button
                    onClick={() => setShowCreateDocModal(false)}
                    style={{
                      background: 'transparent',
                      border: 'none',
                      color: 'white',
                      fontSize: '1.5rem',
                      cursor: 'pointer',
                      padding: '0.25rem'
                    }}
                  >
                    ×
                  </button>
                </div>
                <div style={{ padding: '1.5rem' }}>
                  <DocumentForm 
                    onSave={handleCreateDocument}
                    onCancel={() => setShowCreateDocModal(false)}
                  />
                </div>
              </div>
            </div>
          )}

          {/* Edit Document Modal */}
          {editingDocument && (
            <div 
              style={{
                position: 'fixed',
                inset: 0,
                background: 'rgba(0, 0, 0, 0.85)',
                backdropFilter: 'blur(4px)',
                zIndex: 50,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '1rem'
              }}
              onClick={() => setEditingDocument(null)}
            >
              <div 
                style={{
                  background: '#1a1a1a',
                  border: '2px solid #00d9ff',
                  borderRadius: '0.5rem',
                  maxWidth: '600px',
                  width: '100%',
                  maxHeight: '90vh',
                  overflow: 'auto',
                  boxShadow: '0 0 60px rgba(0, 217, 255, 0.4)'
                }}
                onClick={(e) => e.stopPropagation()}
              >
                <div style={{
                  padding: '1.5rem',
                  borderBottom: '1px solid rgba(0, 217, 255, 0.3)',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center'
                }}>
                  <h2 style={{ color: '#00d9ff', fontSize: '1.25rem' }}>EDIT DOCUMENT</h2>
                  <button
                    onClick={() => setEditingDocument(null)}
                    style={{
                      background: 'transparent',
                      border: 'none',
                      color: 'white',
                      fontSize: '1.5rem',
                      cursor: 'pointer',
                      padding: '0.25rem'
                    }}
                  >
                    ×
                  </button>
                </div>
                <div style={{ padding: '1.5rem' }}>
                  <DocumentForm 
                    document={editingDocument}
                    onSave={(formData) => handleUpdateDocument(editingDocument.id, formData)}
                    onCancel={() => setEditingDocument(null)}
                  />
                </div>
              </div>
            </div>
          )}

          {/* Toast Notification */}
          {toast && (
            <div className="toast">
              <div style={{ fontWeight: '500' }}>{toast.message}</div>
            </div>
          )}
        </div>
      );
    };

    // ==================== APP ROOT ====================
    const App = () => {
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [currentUser, setCurrentUser] = useState(null);
      const [checking, setChecking] = useState(true);

      useEffect(() => {
        // Check if user is already logged in
        const checkAuth = async () => {
          const token = getAuthToken();
          if (token) {
            try {
              const data = await apiRequest('/auth/me');
              if (data.success) {
                setCurrentUser(data.data);
                setIsAuthenticated(true);
              } else {
                removeAuthToken();
              }
            } catch (error) {
              removeAuthToken();
            }
          }
          setChecking(false);
        };
        
        checkAuth();
      }, []);

      const handleLoginSuccess = (user) => {
        setCurrentUser(user);
        setIsAuthenticated(true);
      };

      const handleLogout = () => {
        setCurrentUser(null);
        setIsAuthenticated(false);
      };

      if (checking) {
        return (
          <div style={{
            minHeight: '100vh',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center'
          }}>
            <div className="spinner" style={{ width: '48px', height: '48px' }} />
          </div>
        );
      }

      return isAuthenticated ? (
        <MainApp user={currentUser} onLogout={handleLogout} />
      ) : (
        <LoginPage onLoginSuccess={handleLoginSuccess} />
      );
    };

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
