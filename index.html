<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Production Tech Documentation Platform</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0a0a0a;
      color: white;
      overflow-x: hidden;
    }

    .glow-cyan {
      box-shadow: 0 0 40px rgba(0, 217, 255, 0.3);
    }

    .glow-item {
      transition: all 0.3s ease;
    }

    .glow-item:hover {
      transform: translateY(-2px);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }

    .grid-bg {
      background-image: 
        linear-gradient(rgba(0, 217, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 217, 255, 0.03) 1px, transparent 1px);
      background-size: 20px 20px;
    }

    input, select, textarea {
      background: #2a2a2a;
      border: 1px solid rgba(0, 217, 255, 0.3);
      color: white;
      padding: 0.5rem;
      border-radius: 0.375rem;
      font-family: monospace;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #00d9ff;
    }

    button {
      cursor: pointer;
      transition: all 0.2s ease;
    }

    button:hover {
      transform: translateY(-1px);
    }

    .toast {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: #1a1a1a;
      border: 2px solid #00ff88;
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 0 30px rgba(0, 255, 136, 0.4);
      z-index: 100;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
    }

    .login-box {
      background: #1a1a1a;
      border: 2px solid #00d9ff;
      border-radius: 1rem;
      padding: 3rem;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 0 60px rgba(0, 217, 255, 0.3);
    }

    .spinner {
      border: 3px solid rgba(0, 217, 255, 0.1);
      border-top: 3px solid #00d9ff;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 0.5rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { Lock, User, AlertCircle } = lucide;

    // ==================== API CONFIGURATION ====================
    const API_BASE_URL = 'https://production-docs-backend-production.up.railway.app/api';
    
    // ==================== API HELPER FUNCTIONS ====================
    const getAuthToken = () => localStorage.getItem('auth_token');
    const setAuthToken = (token) => localStorage.setItem('auth_token', token);
    const removeAuthToken = () => localStorage.removeItem('auth_token');
    
    const apiRequest = async (endpoint, options = {}) => {
      const token = getAuthToken();
      const headers = {
        'Content-Type': 'application/json',
        ...options.headers,
      };
      
      if (token) {
        headers['Authorization'] = `Bearer ${token}`;
      }
      
      try {
        console.log(`API Request: ${endpoint}`, options);
        const response = await fetch(`${API_BASE_URL}${endpoint}`, {
          ...options,
          headers,
        });
        
        console.log(`API Response (${endpoint}):`, response.status, response.statusText);
        
        const data = await response.json();
        console.log(`API Data (${endpoint}):`, data);
        
        if (!response.ok) {
          throw new Error(data.error || `API request failed: ${response.status}`);
        }
        
        return data;
      } catch (error) {
        console.error('API Error:', error);
        throw error;
      }
    };

    // ==================== LOGIN COMPONENT ====================
    const LoginPage = ({ onLoginSuccess }) => {
      const [email, setEmail] = useState('admin@venue.com');
      const [password, setPassword] = useState('admin123');
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');

      const handleLogin = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);

        try {
          const data = await apiRequest('/auth/login', {
            method: 'POST',
            body: JSON.stringify({ email, password }),
          });

          if (data.success) {
            setAuthToken(data.data.token);
            onLoginSuccess(data.data.user);
          }
        } catch (err) {
          setError(err.message || 'Login failed. Please check your credentials.');
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="login-container">
          <div className="login-box fade-in">
            <div style={{ textAlign: 'center', marginBottom: '2rem' }}>
              <div style={{ 
                fontSize: '3rem', 
                marginBottom: '1rem',
                background: 'linear-gradient(135deg, #00d9ff 0%, #00ff88 100%)',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent',
                fontWeight: 'bold'
              }}>
                PRODUCTION DOCS
              </div>
              <div style={{ 
                fontSize: '0.9rem', 
                color: 'rgba(255,255,255,0.6)',
                fontFamily: 'monospace',
                letterSpacing: '2px'
              }}>
                TECHNICAL DOCUMENTATION PLATFORM
              </div>
            </div>

            <form onSubmit={handleLogin} style={{ marginTop: '2rem' }}>
              <div style={{ marginBottom: '1.5rem' }}>
                <label style={{ 
                  display: 'block', 
                  marginBottom: '0.5rem',
                  color: '#00d9ff',
                  fontSize: '0.9rem',
                  fontWeight: '500'
                }}>
                  Email
                </label>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  required
                  style={{ width: '100%', padding: '0.75rem' }}
                  placeholder="Enter your email"
                />
              </div>

              <div style={{ marginBottom: '1.5rem' }}>
                <label style={{ 
                  display: 'block', 
                  marginBottom: '0.5rem',
                  color: '#00d9ff',
                  fontSize: '0.9rem',
                  fontWeight: '500'
                }}>
                  Password
                </label>
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  required
                  style={{ width: '100%', padding: '0.75rem' }}
                  placeholder="Enter your password"
                />
              </div>

              {error && (
                <div style={{
                  background: 'rgba(255, 0, 85, 0.1)',
                  border: '1px solid #ff0055',
                  borderRadius: '0.5rem',
                  padding: '0.75rem',
                  marginBottom: '1.5rem',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '0.5rem'
                }}>
                  <AlertCircle size={16} color="#ff0055" />
                  <span style={{ fontSize: '0.9rem', color: '#ff0055' }}>{error}</span>
                </div>
              )}

              <button
                type="submit"
                disabled={loading}
                style={{
                  width: '100%',
                  padding: '0.75rem',
                  background: 'linear-gradient(135deg, #00d9ff 0%, #00ff88 100%)',
                  border: 'none',
                  borderRadius: '0.5rem',
                  color: '#0a0a0a',
                  fontWeight: 'bold',
                  fontSize: '1rem',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  opacity: loading ? 0.7 : 1,
                  cursor: loading ? 'not-allowed' : 'pointer'
                }}
              >
                {loading ? (
                  <>
                    <span className="spinner" />
                    Logging in...
                  </>
                ) : (
                  'LOGIN'
                )}
              </button>
            </form>

            <div style={{ 
              marginTop: '2rem', 
              textAlign: 'center',
              fontSize: '0.85rem',
              color: 'rgba(255,255,255,0.5)',
              fontFamily: 'monospace'
            }}>
              <div>Default credentials:</div>
              <div style={{ marginTop: '0.5rem', color: '#00d9ff' }}>
                admin@venue.com / admin123
              </div>
            </div>
          </div>
        </div>
      );
    };

    // ==================== EQUIPMENT FORM ====================
    const EquipmentForm = ({ equipment, onSave, onCancel }) => {
      const [formData, setFormData] = useState({
        name: equipment?.name || '',
        category_id: equipment?.category_id || 'audio',
        type: equipment?.type || '',
        manufacturer: equipment?.manufacturer || '',
        model: equipment?.model || '',
        serial_number: equipment?.serial_number || '',
        location: equipment?.location || '',
        status: equipment?.status || 'operational',
        purchase_date: equipment?.purchase_date || null,
        warranty_expires: equipment?.warranty_expires || null,
        last_service_date: equipment?.last_service_date || null,
        next_service_date: equipment?.next_service_date || null,
        notes: equipment?.notes || ''
      });
      const [saving, setSaving] = useState(false);
      const isEditing = !!equipment;

      const handleSubmit = async (e) => {
        e.preventDefault();
        setSaving(true);
        await onSave(formData);
        setSaving(false);
      };

      return (
        <form onSubmit={handleSubmit}>
          <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
            <div>
              <label style={{ 
                display: 'block', 
                marginBottom: '0.5rem', 
                color: '#00ff88', 
                fontSize: '0.85rem',
                fontWeight: '500'
              }}>
                EQUIPMENT NAME *
              </label>
              <input
                type="text"
                value={formData.name}
                onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                required
                style={{ width: '100%' }}
                placeholder="Enter equipment name"
              />
            </div>

            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
              <div>
                <label style={{ 
                  display: 'block', 
                  marginBottom: '0.5rem', 
                  color: '#00ff88', 
                  fontSize: '0.85rem',
                  fontWeight: '500'
                }}>
                  CATEGORY
                </label>
                <select
                  value={formData.category_id}
                  onChange={(e) => setFormData({ ...formData, category_id: e.target.value })}
                  style={{ width: '100%' }}
                >
                  <option value="audio">Audio</option>
                  <option value="video">Video</option>
                  <option value="lighting">Lighting</option>
                  <option value="network">Network</option>
                </select>
              </div>

              <div>
                <label style={{ 
                  display: 'block', 
                  marginBottom: '0.5rem', 
                  color: '#00ff88', 
                  fontSize: '0.85rem',
                  fontWeight: '500'
                }}>
                  TYPE
                </label>
                <input
                  type="text"
                  value={formData.type}
                  onChange={(e) => setFormData({ ...formData, type: e.target.value })}
                  style={{ width: '100%' }}
                  placeholder="e.g., Microphone, Console, Amplifier"
                />
              </div>
            </div>

            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
              <div>
                <label style={{ 
                  display: 'block', 
                  marginBottom: '0.5rem', 
                  color: '#00ff88', 
                  fontSize: '0.85rem',
                  fontWeight: '500'
                }}>
                  STATUS
                </label>
                <select
                  value={formData.status}
                  onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                  style={{ width: '100%' }}
                >
                  <option value="operational">Operational</option>
                  <option value="maintenance">Maintenance</option>
                  <option value="offline">Offline</option>
                </select>
              </div>

              <div>
                <label style={{ 
                  display: 'block', 
                  marginBottom: '0.5rem', 
                  color: '#00ff88', 
                  fontSize: '0.85rem',
                  fontWeight: '500'
                }}>
                  LOCATION
                </label>
                <input
                  type="text"
                  value={formData.location}
                  onChange={(e) => setFormData({ ...formData, location: e.target.value })}
                  style={{ width: '100%' }}
                  placeholder="e.g., FOH, Stage Left, Rack 3"
                />
              </div>
            </div>

            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
              <div>
                <label style={{ 
                  display: 'block', 
                  marginBottom: '0.5rem', 
                  color: '#00ff88', 
                  fontSize: '0.85rem',
                  fontWeight: '500'
                }}>
                  MANUFACTURER
                </label>
                <input
                  type="text"
                  value={formData.manufacturer}
                  onChange={(e) => setFormData({ ...formData, manufacturer: e.target.value })}
                  style={{ width: '100%' }}
                  placeholder="e.g., Shure, Allen & Heath"
                />
              </div>

              <div>
                <label style={{ 
                  display: 'block', 
                  marginBottom: '0.5rem', 
                  color: '#00ff88', 
                  fontSize: '0.85rem',
                  fontWeight: '500'
                }}>
                  MODEL
                </label>
                <input
                  type="text"
                  value={formData.model}
                  onChange={(e) => setFormData({ ...formData, model: e.target.value })}
                  style={{ width: '100%' }}
                  placeholder="e.g., SM58, dLive C3500"
                />
              </div>
            </div>

            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
              <div>
                <label style={{ 
                  display: 'block', 
                  marginBottom: '0.5rem', 
                  color: '#00ff88', 
                  fontSize: '0.85rem',
                  fontWeight: '500'
                }}>
                  SERIAL NUMBER
                </label>
                <input
                  type="text"
                  value={formData.serial_number}
                  onChange={(e) => setFormData({ ...formData, serial_number: e.target.value })}
                  style={{ width: '100%' }}
                  placeholder="Optional"
                />
              </div>

              <div></div>
            </div>

            <div>
              <label style={{ 
                display: 'block', 
                marginBottom: '0.5rem', 
                color: '#00ff88', 
                fontSize: '0.85rem',
                fontWeight: '500'
              }}>
                NOTES
              </label>
              <textarea
                value={formData.notes}
                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                rows="4"
                style={{ width: '100%', resize: 'vertical' }}
                placeholder="Additional information, specifications, etc."
              />
            </div>

            <div style={{ display: 'flex', gap: '1rem', marginTop: '1rem' }}>
              <button
                type="submit"
                disabled={saving}
                style={{
                  flex: 1,
                  padding: '0.75rem',
                  background: saving ? '#666' : 'linear-gradient(135deg, #00ff88 0%, #00d9ff 100%)',
                  borderRadius: '0.375rem',
                  border: 'none',
                  color: '#0a0a0a',
                  fontWeight: 'bold',
                  cursor: saving ? 'not-allowed' : 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  gap: '0.5rem'
                }}
              >
                {saving ? (
                  <>
                    <span className="spinner" style={{ width: '16px', height: '16px', borderTopColor: '#0a0a0a' }} />
                    SAVING...
                  </>
                ) : (
                  isEditing ? 'UPDATE EQUIPMENT' : 'SAVE EQUIPMENT'
                )}
              </button>
              <button
                type="button"
                onClick={onCancel}
                style={{
                  padding: '0.75rem 1.5rem',
                  background: 'transparent',
                  border: '1px solid rgba(255, 255, 255, 0.2)',
                  borderRadius: '0.375rem',
                  color: 'white',
                  cursor: 'pointer'
                }}
              >
                CANCEL
              </button>
            </div>
          </div>
        </form>
      );
    };

    // ==================== TABLE BUILDER ====================
    const TableBuilder = ({ onInsert, onCancel }) => {
      const [tableName, setTableName] = useState('');
      const [columns, setColumns] = useState(['Input', 'Output', 'Notes']);
      const [rows, setRows] = useState([['', '', '']]);

      // Listen for table data to load
      React.useEffect(() => {
        const handleLoadTableData = (event) => {
          const table = event.detail;
          if (table) {
            setTableName(table.name || '');
            setColumns(table.columns || ['Column 1']);
            setRows(table.rows || [['']]);
          }
        };
        
        window.addEventListener('loadTableData', handleLoadTableData);
        return () => window.removeEventListener('loadTableData', handleLoadTableData);
      }, []);

      const templates = {
        'input-list': {
          name: 'Input List',
          columns: ['#', 'Input Name', 'Source', 'Connector', 'Notes'],
          rows: [['1', '', '', 'XLR', '']]
        },
        'output-list': {
          name: 'Output List',
          columns: ['#', 'Output Name', 'Destination', 'Connector', 'Notes'],
          rows: [['1', '', '', 'XLR', '']]
        },
        'patch-panel': {
          name: 'Patch Panel',
          columns: ['Front', 'Rear', 'Signal', 'Status'],
          rows: [['1', '1', '', 'Active']]
        },
        'signal-flow': {
          name: 'Signal Flow',
          columns: ['Source', 'Processing', 'Destination', 'Level'],
          rows: [['', '', '', '0dB']]
        },
        'network': {
          name: 'Network Devices',
          columns: ['Device', 'IP Address', 'Subnet', 'Gateway', 'VLAN'],
          rows: [['', '192.168.1.', '255.255.255.0', '192.168.1.1', '']]
        }
      };

      const loadTemplate = (templateKey) => {
        const template = templates[templateKey];
        setTableName(template.name);
        setColumns(template.columns);
        setRows(template.rows);
      };

      const addColumn = () => {
        setColumns([...columns, 'New Column']);
        setRows(rows.map(row => [...row, '']));
      };

      const removeColumn = (index) => {
        setColumns(columns.filter((_, i) => i !== index));
        setRows(rows.map(row => row.filter((_, i) => i !== index)));
      };

      const updateColumn = (index, value) => {
        const newColumns = [...columns];
        newColumns[index] = value;
        setColumns(newColumns);
      };

      const addRow = () => {
        setRows([...rows, columns.map(() => '')]);
      };

      const removeRow = (index) => {
        setRows(rows.filter((_, i) => i !== index));
      };

      const updateCell = (rowIndex, colIndex, value) => {
        const newRows = [...rows];
        newRows[rowIndex][colIndex] = value;
        setRows(newRows);
      };

      const handleInsert = () => {
        const table = {
          name: tableName || 'Table',
          columns,
          rows
        };
        onInsert(table);
      };

      return (
        <div style={{ background: '#0a0a0a', padding: '1.5rem', borderRadius: '0.5rem', border: '1px solid rgba(0, 217, 255, 0.3)' }}>
          <h3 style={{ color: '#00d9ff', marginBottom: '1rem', fontSize: '1.1rem' }}>TABLE BUILDER</h3>

          {/* Templates */}
          <div style={{ marginBottom: '1rem' }}>
            <label style={{ display: 'block', marginBottom: '0.5rem', color: '#00d9ff', fontSize: '0.85rem' }}>
              QUICK TEMPLATES
            </label>
            <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
              {Object.entries(templates).map(([key, template]) => (
                <button
                  key={key}
                  onClick={() => loadTemplate(key)}
                  type="button"
                  style={{
                    padding: '0.4rem 0.75rem',
                    background: 'rgba(0, 217, 255, 0.1)',
                    border: '1px solid rgba(0, 217, 255, 0.5)',
                    borderRadius: '0.25rem',
                    color: '#00d9ff',
                    fontSize: '0.75rem',
                    cursor: 'pointer'
                  }}
                >
                  {template.name}
                </button>
              ))}
            </div>
          </div>

          {/* Table Name */}
          <div style={{ marginBottom: '1rem' }}>
            <label style={{ display: 'block', marginBottom: '0.5rem', color: '#00d9ff', fontSize: '0.85rem' }}>
              TABLE NAME
            </label>
            <input
              type="text"
              value={tableName}
              onChange={(e) => setTableName(e.target.value)}
              placeholder="e.g., Main FOH Inputs"
              style={{ width: '100%' }}
            />
          </div>

          {/* Column Headers */}
          <div style={{ marginBottom: '1rem' }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' }}>
              <label style={{ color: '#00d9ff', fontSize: '0.85rem' }}>COLUMNS</label>
              <button
                type="button"
                onClick={addColumn}
                style={{
                  padding: '0.25rem 0.5rem',
                  background: 'rgba(0, 255, 136, 0.1)',
                  border: '1px solid #00ff88',
                  borderRadius: '0.25rem',
                  color: '#00ff88',
                  fontSize: '0.75rem',
                  cursor: 'pointer'
                }}
              >
                + Column
              </button>
            </div>
            <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
              {columns.map((col, i) => (
                <div key={i} style={{ display: 'flex', gap: '0.25rem', alignItems: 'center' }}>
                  <input
                    type="text"
                    value={col}
                    onChange={(e) => updateColumn(i, e.target.value)}
                    style={{ width: '120px', padding: '0.4rem' }}
                  />
                  {columns.length > 1 && (
                    <button
                      type="button"
                      onClick={() => removeColumn(i)}
                      style={{
                        padding: '0.4rem',
                        background: 'rgba(255, 0, 85, 0.1)',
                        border: '1px solid #ff0055',
                        borderRadius: '0.25rem',
                        color: '#ff0055',
                        fontSize: '0.75rem',
                        cursor: 'pointer'
                      }}
                    >
                      Ã—
                    </button>
                  )}
                </div>
              ))}
            </div>
          </div>

          {/* Table Data */}
          <div style={{ marginBottom: '1rem', maxHeight: '300px', overflow: 'auto' }} className="scrollbar-custom">
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' }}>
              <label style={{ color: '#00d9ff', fontSize: '0.85rem' }}>ROWS</label>
              <button
                type="button"
                onClick={addRow}
                style={{
                  padding: '0.25rem 0.5rem',
                  background: 'rgba(0, 255, 136, 0.1)',
                  border: '1px solid #00ff88',
                  borderRadius: '0.25rem',
                  color: '#00ff88',
                  fontSize: '0.75rem',
                  cursor: 'pointer'
                }}
              >
                + Row
              </button>
            </div>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <thead>
                <tr>
                  {columns.map((col, i) => (
                    <th key={i} style={{
                      padding: '0.5rem',
                      background: '#2a2a2a',
                      border: '1px solid rgba(0, 217, 255, 0.3)',
                      color: '#00d9ff',
                      fontSize: '0.75rem',
                      fontWeight: '500',
                      textAlign: 'left'
                    }}>
                      {col}
                    </th>
                  ))}
                  <th style={{ width: '40px', background: '#2a2a2a', border: '1px solid rgba(0, 217, 255, 0.3)' }}></th>
                </tr>
              </thead>
              <tbody>
                {rows.map((row, rowIndex) => (
                  <tr key={rowIndex}>
                    {row.map((cell, colIndex) => (
                      <td key={colIndex} style={{ padding: '0.25rem', border: '1px solid rgba(0, 217, 255, 0.2)' }}>
                        <input
                          type="text"
                          value={cell}
                          onChange={(e) => updateCell(rowIndex, colIndex, e.target.value)}
                          style={{ 
                            width: '100%', 
                            padding: '0.4rem', 
                            background: '#1a1a1a',
                            border: '1px solid rgba(0, 217, 255, 0.2)',
                            fontSize: '0.8rem'
                          }}
                        />
                      </td>
                    ))}
                    <td style={{ border: '1px solid rgba(0, 217, 255, 0.2)', textAlign: 'center' }}>
                      {rows.length > 1 && (
                        <button
                          type="button"
                          onClick={() => removeRow(rowIndex)}
                          style={{
                            padding: '0.25rem 0.5rem',
                            background: 'rgba(255, 0, 85, 0.1)',
                            border: '1px solid #ff0055',
                            borderRadius: '0.25rem',
                            color: '#ff0055',
                            fontSize: '0.75rem',
                            cursor: 'pointer'
                          }}
                        >
                          Ã—
                        </button>
                      )}
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          {/* Actions */}
          <div style={{ display: 'flex', gap: '0.5rem' }}>
            <button
              type="button"
              onClick={handleInsert}
              style={{
                flex: 1,
                padding: '0.75rem',
                background: 'linear-gradient(135deg, #00d9ff 0%, #00ff88 100%)',
                borderRadius: '0.375rem',
                color: '#0a0a0a',
                fontWeight: 'bold',
                cursor: 'pointer'
              }}
            >
              INSERT TABLE
            </button>
            <button
              type="button"
              onClick={onCancel}
              style={{
                padding: '0.75rem 1.5rem',
                background: 'transparent',
                border: '1px solid rgba(255, 255, 255, 0.2)',
                borderRadius: '0.375rem',
                color: 'white',
                cursor: 'pointer'
              }}
            >
              CANCEL
            </button>
          </div>
        </div>
      );
    };

    // ==================== CREATE/EDIT DOCUMENT FORM ====================
    const DocumentForm = ({ document, onSave, onCancel }) => {
      const [formData, setFormData] = useState({
        title: document?.title || '',
        description: document?.description || '',
        category_id: document?.category_id || 'audio',
        document_type_id: document?.document_type_id || 'procedure',
        status: document?.status || 'draft'
      });
      const [saving, setSaving] = useState(false);
      const [showTableBuilder, setShowTableBuilder] = useState(false);
      const [tables, setTables] = useState([]);
      const isEditing = !!document;

      // Parse existing tables from description if editing
      React.useEffect(() => {
        if (document?.description) {
          const tableMatches = document.description.match(/\[TABLE:.*?\]/gs);
          if (tableMatches) {
            const parsedTables = tableMatches.map(match => {
              try {
                return JSON.parse(match.replace('[TABLE:', '').replace(']', ''));
              } catch {
                return null;
              }
            }).filter(Boolean);
            setTables(parsedTables);
          }
        }
      }, [document]);

      const handleSubmit = async (e) => {
        e.preventDefault();
        setSaving(true);
        await onSave(formData);
        setSaving(false);
      };

      return (
        <form onSubmit={handleSubmit}>
          <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
            <div>
              <label style={{ 
                display: 'block', 
                marginBottom: '0.5rem', 
                color: '#00d9ff', 
                fontSize: '0.85rem',
                fontWeight: '500'
              }}>
                TITLE *
              </label>
              <input
                type="text"
                value={formData.title}
                onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                required
                style={{ width: '100%' }}
                placeholder="Enter document title"
              />
            </div>

            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
              <div>
                <label style={{ 
                  display: 'block', 
                  marginBottom: '0.5rem', 
                  color: '#00d9ff', 
                  fontSize: '0.85rem',
                  fontWeight: '500'
                }}>
                  CATEGORY
                </label>
                <select
                  value={formData.category_id}
                  onChange={(e) => setFormData({ ...formData, category_id: e.target.value })}
                  style={{ width: '100%' }}
                >
                  <option value="audio">Audio</option>
                  <option value="video">Video</option>
                  <option value="lighting">Lighting</option>
                  <option value="network">Network</option>
                </select>
              </div>

              <div>
                <label style={{ 
                  display: 'block', 
                  marginBottom: '0.5rem', 
                  color: '#00d9ff', 
                  fontSize: '0.85rem',
                  fontWeight: '500'
                }}>
                  TYPE
                </label>
                <select
                  value={formData.document_type_id}
                  onChange={(e) => setFormData({ ...formData, document_type_id: e.target.value })}
                  style={{ width: '100%' }}
                >
                  <option value="procedure">Procedure</option>
                  <option value="signal-flow">Signal Flow</option>
                  <option value="topology">Topology</option>
                  <option value="patching">Patching</option>
                  <option value="troubleshooting">Troubleshooting</option>
                </select>
              </div>
            </div>

            <div>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' }}>
                <label style={{ 
                  color: '#00d9ff', 
                  fontSize: '0.85rem',
                  fontWeight: '500'
                }}>
                  DESCRIPTION *
                </label>
                <button
                  type="button"
                  onClick={() => setShowTableBuilder(!showTableBuilder)}
                  style={{
                    padding: '0.4rem 0.75rem',
                    background: 'rgba(0, 217, 255, 0.1)',
                    border: '1px solid #00d9ff',
                    borderRadius: '0.375rem',
                    color: '#00d9ff',
                    fontSize: '0.75rem',
                    cursor: 'pointer',
                    fontWeight: '500'
                  }}
                >
                  {showTableBuilder ? 'âˆ’ HIDE TABLE BUILDER' : '+ ADD TABLE'}
                </button>
              </div>

              {showTableBuilder && (
                <div style={{ marginBottom: '1rem' }}>
                  <TableBuilder
                    onInsert={(table) => {
                      const tableText = `\n\n[TABLE:${JSON.stringify(table)}]\n\n`;
                      setFormData({ ...formData, description: formData.description + tableText });
                      setTables([...tables, table]);
                      setShowTableBuilder(false);
                    }}
                    onCancel={() => setShowTableBuilder(false)}
                  />
                </div>
              )}

              <textarea
                value={formData.description}
                onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                required
                rows="8"
                style={{ width: '100%', resize: 'vertical' }}
                placeholder="Enter document description (tables will be shown separately below)..."
              />
              
              <div style={{
                marginTop: '0.5rem',
                padding: '0.5rem',
                background: 'rgba(0, 217, 255, 0.05)',
                border: '1px solid rgba(0, 217, 255, 0.15)',
                borderRadius: '0.25rem',
                fontSize: '0.75rem',
                color: 'rgba(255,255,255,0.5)'
              }}>
                ðŸ’¡ Tables are managed separately below. The [TABLE:...] markers in your description will be replaced with formatted tables when viewing.
              </div>
              
              {tables.length > 0 && (
                <div style={{ 
                  marginTop: '0.5rem',
                  padding: '1rem',
                  background: 'rgba(0, 217, 255, 0.05)',
                  border: '1px solid rgba(0, 217, 255, 0.2)',
                  borderRadius: '0.375rem'
                }}>
                  <div style={{ 
                    fontSize: '0.85rem',
                    fontWeight: '500',
                    color: '#00d9ff',
                    marginBottom: '0.75rem'
                  }}>
                    TABLES IN THIS DOCUMENT ({tables.length})
                  </div>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                    {tables.map((table, tableIndex) => (
                      <div 
                        key={tableIndex}
                        style={{
                          padding: '0.75rem',
                          background: '#1a1a1a',
                          border: '1px solid rgba(0, 217, 255, 0.3)',
                          borderRadius: '0.25rem'
                        }}
                      >
                        <div style={{ 
                          display: 'flex',
                          justifyContent: 'space-between',
                          alignItems: 'center',
                          marginBottom: '0.75rem'
                        }}>
                          <div>
                            <div style={{ color: 'white', fontSize: '0.85rem', fontWeight: '500' }}>
                              ðŸ“Š {table.name || 'Untitled Table'}
                            </div>
                            <div style={{ color: 'rgba(255,255,255,0.5)', fontSize: '0.75rem', marginTop: '0.25rem' }}>
                              {table.columns?.length || 0} columns Ã— {table.rows?.length || 0} rows
                            </div>
                          </div>
                          <div style={{ display: 'flex', gap: '0.5rem' }}>
                            <button
                              type="button"
                              onClick={() => {
                                // Remove old table from description
                                const oldTableStr = `[TABLE:${JSON.stringify(table)}]`;
                                const newDesc = formData.description.replace(oldTableStr, '');
                                setFormData({ ...formData, description: newDesc });
                                setTables(tables.filter((_, i) => i !== tableIndex));
                                
                                // Show table builder pre-populated with this table's data
                                setShowTableBuilder(true);
                                
                                // Pre-populate the table builder
                                setTimeout(() => {
                                  const event = new CustomEvent('loadTableData', { detail: table });
                                  window.dispatchEvent(event);
                                }, 100);
                              }}
                              style={{
                                padding: '0.4rem 0.75rem',
                                background: 'rgba(0, 217, 255, 0.1)',
                                border: '1px solid #00d9ff',
                                borderRadius: '0.25rem',
                                color: '#00d9ff',
                                fontSize: '0.75rem',
                                cursor: 'pointer',
                                fontWeight: '500'
                              }}
                            >
                              EDIT
                            </button>
                            <button
                              type="button"
                              onClick={() => {
                                if (!confirm(`Delete table "${table.name || 'Untitled'}"?`)) return;
                                const tableStr = `[TABLE:${JSON.stringify(table)}]`;
                                const newDesc = formData.description.replace(tableStr, '');
                                setFormData({ ...formData, description: newDesc });
                                setTables(tables.filter((_, i) => i !== tableIndex));
                              }}
                              style={{
                                padding: '0.4rem 0.75rem',
                                background: 'rgba(255, 0, 85, 0.1)',
                                border: '1px solid #ff0055',
                                borderRadius: '0.25rem',
                                color: '#ff0055',
                                fontSize: '0.75rem',
                                cursor: 'pointer',
                                fontWeight: '500'
                              }}
                            >
                              DELETE
                            </button>
                          </div>
                        </div>
                        
                        {/* Table Preview */}
                        <div style={{ 
                          overflowX: 'auto',
                          fontSize: '0.75rem',
                          background: '#0a0a0a',
                          padding: '0.5rem',
                          borderRadius: '0.25rem',
                          border: '1px solid rgba(0, 217, 255, 0.2)'
                        }}>
                          <table style={{ 
                            width: '100%',
                            borderCollapse: 'collapse'
                          }}>
                            <thead>
                              <tr>
                                {(table.columns || []).map((col, i) => (
                                  <th key={i} style={{
                                    padding: '0.4rem',
                                    background: '#1a1a1a',
                                    borderRight: i < (table.columns || []).length - 1 ? '1px solid rgba(0, 217, 255, 0.15)' : 'none',
                                    color: '#00d9ff',
                                    fontSize: '0.7rem',
                                    fontWeight: '500',
                                    textAlign: 'left'
                                  }}>
                                    {col}
                                  </th>
                                ))}
                              </tr>
                            </thead>
                            <tbody>
                              {(table.rows || []).slice(0, 3).map((row, rowIndex) => (
                                <tr key={rowIndex}>
                                  {row.map((cell, cellIndex) => (
                                    <td key={cellIndex} style={{
                                      padding: '0.4rem',
                                      borderRight: cellIndex < row.length - 1 ? '1px solid rgba(0, 217, 255, 0.1)' : 'none',
                                      borderTop: '1px solid rgba(0, 217, 255, 0.1)',
                                      color: 'rgba(255,255,255,0.7)',
                                      fontSize: '0.7rem'
                                    }}>
                                      {cell || '-'}
                                    </td>
                                  ))}
                                </tr>
                              ))}
                              {(table.rows || []).length > 3 && (
                                <tr>
                                  <td 
                                    colSpan={(table.columns || []).length}
                                    style={{
                                      padding: '0.4rem',
                                      textAlign: 'center',
                                      color: 'rgba(255,255,255,0.4)',
                                      fontSize: '0.7rem',
                                      fontStyle: 'italic',
                                      borderTop: '1px solid rgba(0, 217, 255, 0.1)'
                                    }}
                                  >
                                    +{(table.rows || []).length - 3} more rows...
                                  </td>
                                </tr>
                              )}
                            </tbody>
                          </table>
                        </div>
                      </div>
                    ))}
                  </div>
                  <div style={{
                    marginTop: '0.75rem',
                    padding: '0.5rem',
                    background: 'rgba(0, 217, 255, 0.05)',
                    border: '1px solid rgba(0, 217, 255, 0.2)',
                    borderRadius: '0.25rem',
                    fontSize: '0.75rem',
                    color: 'rgba(0, 217, 255, 0.8)'
                  }}>
                    ðŸ’¡ Click EDIT to modify a table, or DELETE to remove it completely.
                  </div>
                </div>
              )}
            </div>

            <div>
              <label style={{ 
                display: 'block', 
                marginBottom: '0.5rem', 
                color: '#00d9ff', 
                fontSize: '0.85rem',
                fontWeight: '500'
              }}>
                STATUS
              </label>
              <select
                value={formData.status}
                onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                style={{ width: '100%' }}
              >
                <option value="draft">Draft</option>
                <option value="published">Published</option>
              </select>
            </div>

            <div style={{ display: 'flex', gap: '1rem', marginTop: '1rem' }}>
              <button
                type="submit"
                disabled={saving}
                style={{
                  flex: 1,
                  padding: '0.75rem',
                  background: saving ? '#666' : 'linear-gradient(135deg, #00d9ff 0%, #00ff88 100%)',
                  borderRadius: '0.375rem',
                  border: 'none',
                  color: '#0a0a0a',
                  fontWeight: 'bold',
                  cursor: saving ? 'not-allowed' : 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  gap: '0.5rem'
                }}
              >
                {saving ? (
                  <>
                    <span className="spinner" style={{ width: '16px', height: '16px', borderTopColor: '#0a0a0a' }} />
                    SAVING...
                  </>
                ) : (
                  isEditing ? 'UPDATE DOCUMENT' : 'SAVE DOCUMENT'
                )}
              </button>
              <button
                type="button"
                onClick={onCancel}
                style={{
                  padding: '0.75rem 1.5rem',
                  background: 'transparent',
                  border: '1px solid rgba(255, 255, 255, 0.2)',
                  borderRadius: '0.375rem',
                  color: 'white',
                  cursor: 'pointer'
                }}
              >
                CANCEL
              </button>
            </div>
          </div>
        </form>
      );
    };

    // ==================== MAIN APP COMPONENT ====================
    const MainApp = ({ user, onLogout }) => {
      const [documents, setDocuments] = useState([]);
      const [equipment, setEquipment] = useState([]);
      const [loading, setLoading] = useState(true);
      const [toast, setToast] = useState(null);
      const [showCreateDocModal, setShowCreateDocModal] = useState(false);
      const [editingDocument, setEditingDocument] = useState(null);
      const [viewingDocument, setViewingDocument] = useState(null);
      const [showCreateEquipModal, setShowCreateEquipModal] = useState(false);
      const [editingEquipment, setEditingEquipment] = useState(null);
      const [viewingEquipment, setViewingEquipment] = useState(null);
      const [searchQuery, setSearchQuery] = useState('');
      const [categoryFilter, setCategoryFilter] = useState('all');
      const [statusFilter, setStatusFilter] = useState('all');

      // Load initial data
      useEffect(() => {
        loadData();
      }, []);

      const loadData = async () => {
        try {
          setLoading(true);
          console.log('Loading data...');
          
          // Load documents
          const docsData = await apiRequest('/documents');
          console.log('Documents response:', docsData);
          if (docsData.success && docsData.data) {
            // Handle nested structure - documents are in data.documents
            const docs = docsData.data.documents || docsData.data;
            setDocuments(Array.isArray(docs) ? docs : []);
            console.log('Set documents:', docs);
          } else {
            setDocuments([]);
          }
          
          // Load equipment
          const equipData = await apiRequest('/equipment');
          console.log('Equipment response:', equipData);
          if (equipData.success && equipData.data) {
            // Handle nested structure if equipment uses same pattern
            const equip = equipData.data.equipment || equipData.data;
            setEquipment(Array.isArray(equip) ? equip : []);
            console.log('Set equipment:', equip);
          } else {
            setEquipment([]);
          }
          
          console.log('Data loaded successfully');
        } catch (error) {
          console.error('Error loading data:', error);
          // Set empty arrays on error so the UI can still render
          setDocuments([]);
          setEquipment([]);
          showToast('Error loading data: ' + error.message, 'error');
        } finally {
          setLoading(false);
        }
      };

      const showToast = (message, type = 'success') => {
        setToast({ message, type });
        setTimeout(() => setToast(null), 3000);
      };

      const handleCreateDocument = async (formData) => {
        try {
          console.log('Sending document data:', formData);
          const result = await apiRequest('/documents', {
            method: 'POST',
            body: JSON.stringify(formData)
          });
          
          console.log('Create document result:', result);
          if (result.success) {
            await loadData();
            setShowCreateDocModal(false);
            showToast('Document created successfully!');
          }
        } catch (error) {
          console.error('Create document error:', error);
          showToast('Error creating document: ' + error.message, 'error');
        }
      };

      const handleUpdateDocument = async (id, formData) => {
        try {
          console.log('Updating document:', id, formData);
          const result = await apiRequest(`/documents/${id}`, {
            method: 'PUT',
            body: JSON.stringify(formData)
          });
          
          console.log('Update document result:', result);
          if (result.success) {
            await loadData();
            setEditingDocument(null);
            showToast('Document updated successfully!');
          }
        } catch (error) {
          console.error('Update document error:', error);
          showToast('Error updating document: ' + error.message, 'error');
        }
      };

      const handleDeleteDocument = async (id, title) => {
        if (!confirm(`Are you sure you want to delete "${title}"? This cannot be undone.`)) {
          return;
        }

        try {
          console.log('Deleting document:', id);
          const result = await apiRequest(`/documents/${id}`, {
            method: 'DELETE'
          });
          
          console.log('Delete document result:', result);
          if (result.success) {
            await loadData();
            showToast('Document deleted successfully!');
          }
        } catch (error) {
          console.error('Delete document error:', error);
          showToast('Error deleting document: ' + error.message, 'error');
        }
      };

      // Equipment handlers
      const handleCreateEquipment = async (formData) => {
        try {
          console.log('Creating equipment:', formData);
          
          // Convert empty strings to null for the backend
          const cleanedData = {};
          for (const [key, value] of Object.entries(formData)) {
            cleanedData[key] = value === '' ? null : value;
          }
          
          const result = await apiRequest('/equipment', {
            method: 'POST',
            body: JSON.stringify(cleanedData)
          });
          
          console.log('Create equipment result:', result);
          if (result.success) {
            await loadData();
            setShowCreateEquipModal(false);
            showToast('Equipment added successfully!');
          }
        } catch (error) {
          console.error('Create equipment error:', error);
          showToast('Error creating equipment: ' + error.message, 'error');
        }
      };

      const handleUpdateEquipment = async (id, formData) => {
        try {
          console.log('Updating equipment:', id, formData);
          
          // Convert empty strings to null for the backend
          const cleanedData = {};
          for (const [key, value] of Object.entries(formData)) {
            cleanedData[key] = value === '' ? null : value;
          }
          
          const result = await apiRequest(`/equipment/${id}`, {
            method: 'PUT',
            body: JSON.stringify(cleanedData)
          });
          
          console.log('Update equipment result:', result);
          if (result.success) {
            await loadData();
            setEditingEquipment(null);
            showToast('Equipment updated successfully!');
          }
        } catch (error) {
          console.error('Update equipment error:', error);
          showToast('Error updating equipment: ' + error.message, 'error');
        }
      };

      const handleDeleteEquipment = async (id, name) => {
        if (!confirm(`Are you sure you want to delete "${name}"? This cannot be undone.`)) {
          return;
        }

        try {
          console.log('Deleting equipment:', id);
          const result = await apiRequest(`/equipment/${id}`, {
            method: 'DELETE'
          });
          
          console.log('Delete equipment result:', result);
          if (result.success) {
            await loadData();
            showToast('Equipment deleted successfully!');
          }
        } catch (error) {
          console.error('Delete equipment error:', error);
          showToast('Error deleting equipment: ' + error.message, 'error');
        }
      };

      // Filter logic
      const filteredDocuments = documents.filter(doc => {
        const matchesSearch = !searchQuery || 
          doc.title?.toLowerCase().includes(searchQuery.toLowerCase()) ||
          doc.description?.toLowerCase().includes(searchQuery.toLowerCase());
        const matchesCategory = categoryFilter === 'all' || doc.category_id === categoryFilter;
        return matchesSearch && matchesCategory;
      });

      const filteredEquipment = equipment.filter(eq => {
        const matchesSearch = !searchQuery ||
          eq.name?.toLowerCase().includes(searchQuery.toLowerCase()) ||
          eq.manufacturer?.toLowerCase().includes(searchQuery.toLowerCase()) ||
          eq.model?.toLowerCase().includes(searchQuery.toLowerCase());
        const matchesCategory = categoryFilter === 'all' || eq.category_id === categoryFilter;
        const matchesStatus = statusFilter === 'all' || eq.status === statusFilter;
        return matchesSearch && matchesCategory && matchesStatus;
      });

      const handleLogout = () => {
        removeAuthToken();
        onLogout();
      };

      if (loading) {
        console.log('MainApp: Still loading...');
        return (
          <div style={{
            minHeight: '100vh',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            flexDirection: 'column',
            gap: '1rem'
          }}>
            <div className="spinner" style={{ width: '48px', height: '48px' }} />
            <div style={{ color: '#00d9ff', fontFamily: 'monospace' }}>
              Loading platform...
            </div>
          </div>
        );
      }

      console.log('MainApp: Rendering dashboard', { documents, equipment, user });

      return (
        <div style={{ padding: '2rem' }}>
          {/* Header */}
          <div style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: '2rem',
            padding: '1rem',
            background: '#1a1a1a',
            border: '2px solid #00d9ff',
            borderRadius: '0.5rem'
          }}>
            <div>
              <h1 style={{ 
                fontSize: '1.5rem',
                background: 'linear-gradient(135deg, #00d9ff 0%, #00ff88 100%)',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent'
              }}>
                Production Documentation Platform
              </h1>
              <div style={{ 
                fontSize: '0.9rem',
                color: 'rgba(255,255,255,0.6)',
                marginTop: '0.25rem'
              }}>
                Welcome, {user.fullName || user.email}
              </div>
            </div>
            
            <button
              onClick={handleLogout}
              style={{
                padding: '0.5rem 1rem',
                background: 'rgba(255, 0, 85, 0.2)',
                border: '1px solid #ff0055',
                borderRadius: '0.375rem',
                color: '#ff0055',
                fontWeight: '500'
              }}
            >
              Logout
            </button>
          </div>

          {/* Dashboard Stats */}
          <div style={{
            display: 'grid',
            gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
            gap: '1rem',
            marginBottom: '2rem'
          }}>
            <div style={{
              background: '#1a1a1a',
              border: '2px solid #00d9ff',
              borderRadius: '0.5rem',
              padding: '1.5rem'
            }}>
              <div style={{ fontSize: '2rem', color: '#00d9ff', fontWeight: 'bold' }}>
                {documents.length}
              </div>
              <div style={{ color: 'rgba(255,255,255,0.6)', marginTop: '0.5rem' }}>
                Total Documents
              </div>
            </div>

            <div style={{
              background: '#1a1a1a',
              border: '2px solid #00ff88',
              borderRadius: '0.5rem',
              padding: '1.5rem'
            }}>
              <div style={{ fontSize: '2rem', color: '#00ff88', fontWeight: 'bold' }}>
                {equipment.length}
              </div>
              <div style={{ color: 'rgba(255,255,255,0.6)', marginTop: '0.5rem' }}>
                Equipment Items
              </div>
            </div>

            <div style={{
              background: '#1a1a1a',
              border: '2px solid #ffea00',
              borderRadius: '0.5rem',
              padding: '1.5rem'
            }}>
              <div style={{ fontSize: '2rem', color: '#ffea00', fontWeight: 'bold' }}>
                {equipment.filter(e => e.status === 'operational').length}
              </div>
              <div style={{ color: 'rgba(255,255,255,0.6)', marginTop: '0.5rem' }}>
                Operational
              </div>
            </div>
          </div>

          {/* Recent Documents */}
          <div style={{
            background: '#1a1a1a',
            border: '2px solid #00d9ff',
            borderRadius: '0.5rem',
            padding: '1.5rem',
            marginBottom: '2rem'
          }}>
            <div style={{
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
              marginBottom: '1rem'
            }}>
              <h2 style={{ color: '#00d9ff' }}>
                Documents ({filteredDocuments.length})
              </h2>
              <button
                onClick={() => setShowCreateDocModal(true)}
                style={{
                  padding: '0.5rem 1rem',
                  background: 'linear-gradient(135deg, #00d9ff 0%, #00ff88 100%)',
                  borderRadius: '0.375rem',
                  color: '#0a0a0a',
                  fontWeight: 'bold',
                  fontSize: '0.85rem',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '0.5rem',
                  border: 'none'
                }}
              >
                + NEW DOCUMENT
              </button>
            </div>

            {/* Search and Filter */}
            <div style={{ 
              display: 'flex', 
              gap: '0.75rem', 
              marginBottom: '1rem',
              flexWrap: 'wrap'
            }}>
              <input
                type="text"
                placeholder="Search documents..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                style={{
                  flex: 1,
                  minWidth: '200px',
                  padding: '0.5rem 0.75rem',
                  background: '#2a2a2a',
                  border: '1px solid rgba(0, 217, 255, 0.3)',
                  borderRadius: '0.375rem',
                  color: 'white',
                  fontSize: '0.85rem'
                }}
              />
              <select
                value={categoryFilter}
                onChange={(e) => setCategoryFilter(e.target.value)}
                style={{
                  padding: '0.5rem 0.75rem',
                  background: '#2a2a2a',
                  border: '1px solid rgba(0, 217, 255, 0.3)',
                  borderRadius: '0.375rem',
                  color: 'white',
                  fontSize: '0.85rem',
                  cursor: 'pointer'
                }}
              >
                <option value="all">All Categories</option>
                <option value="audio">Audio</option>
                <option value="video">Video</option>
                <option value="lighting">Lighting</option>
                <option value="network">Network</option>
              </select>
              {(searchQuery || categoryFilter !== 'all') && (
                <button
                  onClick={() => {
                    setSearchQuery('');
                    setCategoryFilter('all');
                  }}
                  style={{
                    padding: '0.5rem 0.75rem',
                    background: 'rgba(255, 0, 85, 0.1)',
                    border: '1px solid #ff0055',
                    borderRadius: '0.375rem',
                    color: '#ff0055',
                    fontSize: '0.75rem',
                    cursor: 'pointer',
                    fontWeight: '500'
                  }}
                >
                  CLEAR
                </button>
              )}
            </div>

            {filteredDocuments.length === 0 ? (
              <div style={{ 
                textAlign: 'center', 
                padding: '2rem',
                color: 'rgba(255,255,255,0.5)'
              }}>
                {documents.length === 0 
                  ? 'No documents yet. Create your first document to get started!'
                  : 'No documents match your search or filters.'
                }
              </div>
            ) : (
              <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                {filteredDocuments.slice(0, 10).map(doc => (
                  <div
                    key={doc.id}
                    style={{
                      padding: '1rem',
                      background: '#2a2a2a',
                      border: '1px solid rgba(0, 217, 255, 0.3)',
                      borderRadius: '0.375rem',
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center'
                    }}
                  >
                    <div style={{ flex: 1 }}>
                      <div style={{ fontWeight: '500' }}>{doc.title}</div>
                      <div style={{ 
                        fontSize: '0.85rem',
                        color: 'rgba(255,255,255,0.6)',
                        marginTop: '0.25rem'
                      }}>
                        {doc.category_id} â€¢ {new Date(doc.created_at).toLocaleDateString()}
                      </div>
                    </div>
                    <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                      <div style={{
                        padding: '0.25rem 0.75rem',
                        background: doc.status === 'published' ? 'rgba(0, 255, 136, 0.2)' : 'rgba(255, 234, 0, 0.2)',
                        border: `1px solid ${doc.status === 'published' ? '#00ff88' : '#ffea00'}`,
                        borderRadius: '0.25rem',
                        fontSize: '0.75rem',
                        color: doc.status === 'published' ? '#00ff88' : '#ffea00',
                        textTransform: 'uppercase'
                      }}>
                        {doc.status}
                      </div>
                      <button
                        onClick={() => setViewingDocument(doc)}
                        style={{
                          padding: '0.5rem 0.75rem',
                          background: 'rgba(0, 255, 136, 0.1)',
                          border: '1px solid #00ff88',
                          borderRadius: '0.375rem',
                          color: '#00ff88',
                          fontSize: '0.75rem',
                          cursor: 'pointer',
                          fontWeight: '500'
                        }}
                      >
                        VIEW
                      </button>
                      <button
                        onClick={() => setEditingDocument(doc)}
                        style={{
                          padding: '0.5rem 0.75rem',
                          background: 'rgba(0, 217, 255, 0.1)',
                          border: '1px solid #00d9ff',
                          borderRadius: '0.375rem',
                          color: '#00d9ff',
                          fontSize: '0.75rem',
                          cursor: 'pointer',
                          fontWeight: '500'
                        }}
                      >
                        EDIT
                      </button>
                      <button
                        onClick={() => handleDeleteDocument(doc.id, doc.title)}
                        style={{
                          padding: '0.5rem 0.75rem',
                          background: 'rgba(255, 0, 85, 0.1)',
                          border: '1px solid #ff0055',
                          borderRadius: '0.375rem',
                          color: '#ff0055',
                          fontSize: '0.75rem',
                          cursor: 'pointer',
                          fontWeight: '500'
                        }}
                      >
                        DELETE
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Equipment List */}
          <div style={{
            background: '#1a1a1a',
            border: '2px solid #00ff88',
            borderRadius: '0.5rem',
            padding: '1.5rem'
          }}>
            <div style={{
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
              marginBottom: '1rem'
            }}>
              <h2 style={{ color: '#00ff88' }}>
                Equipment ({filteredEquipment.length})
              </h2>
              <button
                onClick={() => setShowCreateEquipModal(true)}
                style={{
                  padding: '0.5rem 1rem',
                  background: 'linear-gradient(135deg, #00ff88 0%, #00d9ff 100%)',
                  borderRadius: '0.375rem',
                  color: '#0a0a0a',
                  fontWeight: 'bold',
                  fontSize: '0.85rem',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '0.5rem',
                  border: 'none'
                }}
              >
                + ADD EQUIPMENT
              </button>
            </div>

            {/* Search and Filter */}
            <div style={{ 
              display: 'flex', 
              gap: '0.75rem', 
              marginBottom: '1rem',
              flexWrap: 'wrap'
            }}>
              <input
                type="text"
                placeholder="Search equipment..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                style={{
                  flex: 1,
                  minWidth: '200px',
                  padding: '0.5rem 0.75rem',
                  background: '#2a2a2a',
                  border: '1px solid rgba(0, 255, 136, 0.3)',
                  borderRadius: '0.375rem',
                  color: 'white',
                  fontSize: '0.85rem'
                }}
              />
              <select
                value={categoryFilter}
                onChange={(e) => setCategoryFilter(e.target.value)}
                style={{
                  padding: '0.5rem 0.75rem',
                  background: '#2a2a2a',
                  border: '1px solid rgba(0, 255, 136, 0.3)',
                  borderRadius: '0.375rem',
                  color: 'white',
                  fontSize: '0.85rem',
                  cursor: 'pointer'
                }}
              >
                <option value="all">All Categories</option>
                <option value="audio">Audio</option>
                <option value="video">Video</option>
                <option value="lighting">Lighting</option>
                <option value="network">Network</option>
              </select>
              <select
                value={statusFilter}
                onChange={(e) => setStatusFilter(e.target.value)}
                style={{
                  padding: '0.5rem 0.75rem',
                  background: '#2a2a2a',
                  border: '1px solid rgba(0, 255, 136, 0.3)',
                  borderRadius: '0.375rem',
                  color: 'white',
                  fontSize: '0.85rem',
                  cursor: 'pointer'
                }}
              >
                <option value="all">All Status</option>
                <option value="operational">Operational</option>
                <option value="maintenance">Maintenance</option>
                <option value="offline">Offline</option>
              </select>
              {(searchQuery || categoryFilter !== 'all' || statusFilter !== 'all') && (
                <button
                  onClick={() => {
                    setSearchQuery('');
                    setCategoryFilter('all');
                    setStatusFilter('all');
                  }}
                  style={{
                    padding: '0.5rem 0.75rem',
                    background: 'rgba(255, 0, 85, 0.1)',
                    border: '1px solid #ff0055',
                    borderRadius: '0.375rem',
                    color: '#ff0055',
                    fontSize: '0.75rem',
                    cursor: 'pointer',
                    fontWeight: '500'
                  }}
                >
                  CLEAR
                </button>
              )}
            </div>

            {filteredEquipment.length === 0 ? (
              <div style={{ 
                textAlign: 'center', 
                padding: '2rem',
                color: 'rgba(255,255,255,0.5)'
              }}>
                {equipment.length === 0
                  ? 'No equipment registered yet. Add your first equipment item!'
                  : 'No equipment matches your search or filters.'
                }
              </div>
            ) : (
              <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                {filteredEquipment.slice(0, 10).map(item => (
                  <div
                    key={item.id}
                    style={{
                      padding: '1rem',
                      background: '#2a2a2a',
                      border: '1px solid rgba(0, 255, 136, 0.3)',
                      borderRadius: '0.375rem',
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center'
                    }}
                  >
                    <div style={{ flex: 1 }}>
                      <div style={{ fontWeight: '500' }}>{item.name}</div>
                      <div style={{ 
                        fontSize: '0.85rem',
                        color: 'rgba(255,255,255,0.6)',
                        marginTop: '0.25rem'
                      }}>
                        {item.manufacturer} {item.model ? `â€¢ ${item.model}` : ''} {item.category_id ? `â€¢ ${item.category_id}` : ''}
                      </div>
                    </div>
                    <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                      <div style={{
                        padding: '0.25rem 0.75rem',
                        background: 
                          item.status === 'operational' ? 'rgba(0, 255, 136, 0.2)' :
                          item.status === 'maintenance' ? 'rgba(255, 234, 0, 0.2)' :
                          'rgba(255, 0, 85, 0.2)',
                        border: `1px solid ${
                          item.status === 'operational' ? '#00ff88' :
                          item.status === 'maintenance' ? '#ffea00' :
                          '#ff0055'
                        }`,
                        borderRadius: '0.25rem',
                        fontSize: '0.75rem',
                        color: 
                          item.status === 'operational' ? '#00ff88' :
                          item.status === 'maintenance' ? '#ffea00' :
                          '#ff0055',
                        textTransform: 'uppercase'
                      }}>
                        {item.status}
                      </div>
                      <button
                        onClick={() => setViewingEquipment(item)}
                        style={{
                          padding: '0.5rem 0.75rem',
                          background: 'rgba(0, 255, 136, 0.1)',
                          border: '1px solid #00ff88',
                          borderRadius: '0.375rem',
                          color: '#00ff88',
                          fontSize: '0.75rem',
                          cursor: 'pointer',
                          fontWeight: '500'
                        }}
                      >
                        VIEW
                      </button>
                      <button
                        onClick={() => setEditingEquipment(item)}
                        style={{
                          padding: '0.5rem 0.75rem',
                          background: 'rgba(0, 217, 255, 0.1)',
                          border: '1px solid #00d9ff',
                          borderRadius: '0.375rem',
                          color: '#00d9ff',
                          fontSize: '0.75rem',
                          cursor: 'pointer',
                          fontWeight: '500'
                        }}
                      >
                        EDIT
                      </button>
                      <button
                        onClick={() => handleDeleteEquipment(item.id, item.name)}
                        style={{
                          padding: '0.5rem 0.75rem',
                          background: 'rgba(255, 0, 85, 0.1)',
                          border: '1px solid #ff0055',
                          borderRadius: '0.375rem',
                          color: '#ff0055',
                          fontSize: '0.75rem',
                          cursor: 'pointer',
                          fontWeight: '500'
                        }}
                      >
                        DELETE
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Create Document Modal */}
          {showCreateDocModal && (
            <div 
              style={{
                position: 'fixed',
                inset: 0,
                background: 'rgba(0, 0, 0, 0.85)',
                backdropFilter: 'blur(4px)',
                zIndex: 50,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '1rem'
              }}
              onClick={() => setShowCreateDocModal(false)}
            >
              <div 
                style={{
                  background: '#1a1a1a',
                  border: '2px solid #00d9ff',
                  borderRadius: '0.5rem',
                  maxWidth: '600px',
                  width: '100%',
                  maxHeight: '90vh',
                  overflow: 'auto',
                  boxShadow: '0 0 60px rgba(0, 217, 255, 0.4)'
                }}
                onClick={(e) => e.stopPropagation()}
              >
                <div style={{
                  padding: '1.5rem',
                  borderBottom: '1px solid rgba(0, 217, 255, 0.3)',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center'
                }}>
                  <h2 style={{ color: '#00d9ff', fontSize: '1.25rem' }}>CREATE NEW DOCUMENT</h2>
                  <button
                    onClick={() => setShowCreateDocModal(false)}
                    style={{
                      background: 'transparent',
                      border: 'none',
                      color: 'white',
                      fontSize: '1.5rem',
                      cursor: 'pointer',
                      padding: '0.25rem'
                    }}
                  >
                    Ã—
                  </button>
                </div>
                <div style={{ padding: '1.5rem' }}>
                  <DocumentForm 
                    onSave={handleCreateDocument}
                    onCancel={() => setShowCreateDocModal(false)}
                  />
                </div>
              </div>
            </div>
          )}

          {/* View Document Modal */}
          {viewingDocument && (
            <div 
              style={{
                position: 'fixed',
                inset: 0,
                background: 'rgba(0, 0, 0, 0.85)',
                backdropFilter: 'blur(4px)',
                zIndex: 50,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '1rem'
              }}
              onClick={() => setViewingDocument(null)}
            >
              <div 
                style={{
                  background: '#1a1a1a',
                  border: '2px solid #00ff88',
                  borderRadius: '0.5rem',
                  maxWidth: '700px',
                  width: '100%',
                  maxHeight: '90vh',
                  overflow: 'auto',
                  boxShadow: '0 0 60px rgba(0, 255, 136, 0.4)'
                }}
                onClick={(e) => e.stopPropagation()}
              >
                <div style={{
                  padding: '1.5rem',
                  borderBottom: '1px solid rgba(0, 255, 136, 0.3)',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'flex-start'
                }}>
                  <div style={{ flex: 1 }}>
                    <h2 style={{ color: '#00ff88', fontSize: '1.5rem', marginBottom: '0.5rem' }}>
                      {viewingDocument.title}
                    </h2>
                    <div style={{ display: 'flex', gap: '0.75rem', flexWrap: 'wrap' }}>
                      <div style={{
                        padding: '0.25rem 0.75rem',
                        background: 'rgba(0, 255, 136, 0.1)',
                        border: '1px solid #00ff88',
                        borderRadius: '0.25rem',
                        fontSize: '0.75rem',
                        color: '#00ff88',
                        textTransform: 'uppercase'
                      }}>
                        {viewingDocument.category_id}
                      </div>
                      <div style={{
                        padding: '0.25rem 0.75rem',
                        background: 'rgba(0, 217, 255, 0.1)',
                        border: '1px solid #00d9ff',
                        borderRadius: '0.25rem',
                        fontSize: '0.75rem',
                        color: '#00d9ff',
                        textTransform: 'uppercase'
                      }}>
                        {viewingDocument.document_type_id}
                      </div>
                      <div style={{
                        padding: '0.25rem 0.75rem',
                        background: viewingDocument.status === 'published' ? 'rgba(0, 255, 136, 0.1)' : 'rgba(255, 234, 0, 0.1)',
                        border: `1px solid ${viewingDocument.status === 'published' ? '#00ff88' : '#ffea00'}`,
                        borderRadius: '0.25rem',
                        fontSize: '0.75rem',
                        color: viewingDocument.status === 'published' ? '#00ff88' : '#ffea00',
                        textTransform: 'uppercase'
                      }}>
                        {viewingDocument.status}
                      </div>
                    </div>
                  </div>
                  <button
                    onClick={() => setViewingDocument(null)}
                    style={{
                      background: 'transparent',
                      border: 'none',
                      color: 'white',
                      fontSize: '1.5rem',
                      cursor: 'pointer',
                      padding: '0.25rem',
                      marginLeft: '1rem'
                    }}
                  >
                    Ã—
                  </button>
                </div>
                <div style={{ padding: '1.5rem' }}>
                  <div style={{ marginBottom: '1.5rem' }}>
                    <div style={{ 
                      fontSize: '0.85rem', 
                      color: 'rgba(255,255,255,0.5)',
                      marginBottom: '0.5rem',
                      textTransform: 'uppercase',
                      letterSpacing: '1px'
                    }}>
                      Description
                    </div>
                    <div style={{ 
                      color: 'white',
                      lineHeight: '1.6'
                    }}>
                      {(() => {
                        const desc = viewingDocument.description || 'No description provided.';
                        const elements = [];
                        let lastIndex = 0;
                        let searchIndex = 0;
                        
                        // Find all [TABLE: blocks
                        while (searchIndex < desc.length) {
                          const tableStart = desc.indexOf('[TABLE:', searchIndex);
                          if (tableStart === -1) {
                            // No more tables, add remaining text
                            if (lastIndex < desc.length) {
                              const text = desc.substring(lastIndex);
                              if (text.trim()) {
                                elements.push(<span key={elements.length} style={{ whiteSpace: 'pre-wrap' }}>{text}</span>);
                              }
                            }
                            break;
                          }
                          
                          // Add text before table
                          if (tableStart > lastIndex) {
                            const text = desc.substring(lastIndex, tableStart);
                            if (text.trim()) {
                              elements.push(<span key={elements.length} style={{ whiteSpace: 'pre-wrap' }}>{text}</span>);
                            }
                          }
                          
                          // Find matching bracket - count braces to handle nested JSON
                          let braceCount = 0;
                          let tableEnd = tableStart + 7; // Start after '[TABLE:'
                          let foundStart = false;
                          
                          while (tableEnd < desc.length) {
                            const char = desc[tableEnd];
                            if (char === '{') {
                              braceCount++;
                              foundStart = true;
                            } else if (char === '}') {
                              braceCount--;
                              if (foundStart && braceCount === 0) {
                                // Found closing brace, now look for ]
                                if (desc[tableEnd + 1] === ']') {
                                  tableEnd += 2;
                                  break;
                                }
                              }
                            }
                            tableEnd++;
                          }
                          
                          // Extract and parse table
                          const tableStr = desc.substring(tableStart, tableEnd);
                          try {
                            const jsonStr = tableStr.substring(7, tableStr.length - 1);
                            const tableData = JSON.parse(jsonStr);
                            
                            // Create sortable table component
                            const SortableTable = ({ data }) => {
                              const [sortConfig, setSortConfig] = React.useState({ column: null, direction: 'asc' });
                              
                              const sortedRows = React.useMemo(() => {
                                if (!sortConfig.column && sortConfig.column !== 0) return data.rows;
                                
                                const sorted = [...data.rows].sort((a, b) => {
                                  const aVal = a[sortConfig.column] || '';
                                  const bVal = b[sortConfig.column] || '';
                                  
                                  // Try numeric comparison first
                                  const aNum = parseFloat(aVal);
                                  const bNum = parseFloat(bVal);
                                  
                                  if (!isNaN(aNum) && !isNaN(bNum)) {
                                    return sortConfig.direction === 'asc' ? aNum - bNum : bNum - aNum;
                                  }
                                  
                                  // Fall back to string comparison
                                  const comparison = aVal.toString().localeCompare(bVal.toString());
                                  return sortConfig.direction === 'asc' ? comparison : -comparison;
                                });
                                
                                return sorted;
                              }, [data.rows, sortConfig]);
                              
                              const handleSort = (columnIndex) => {
                                setSortConfig(prev => ({
                                  column: columnIndex,
                                  direction: prev.column === columnIndex && prev.direction === 'asc' ? 'desc' : 'asc'
                                }));
                              };
                              
                              return (
                                <div style={{ overflowX: 'auto' }}>
                                  <table style={{ 
                                    width: '100%',
                                    borderCollapse: 'collapse',
                                    background: '#1a1a1a',
                                    border: '2px solid rgba(0, 217, 255, 0.4)'
                                  }}>
                                    <thead>
                                      <tr>
                                        {data.columns && data.columns.map((col, i) => (
                                          <th 
                                            key={i} 
                                            onClick={() => handleSort(i)}
                                            style={{
                                              padding: '0.75rem',
                                              background: sortConfig.column === i ? '#2a3a3a' : '#2a2a2a',
                                              borderRight: i < data.columns.length - 1 ? '1px solid rgba(0, 217, 255, 0.2)' : 'none',
                                              borderBottom: '2px solid rgba(0, 217, 255, 0.4)',
                                              color: '#00d9ff',
                                              fontSize: '0.85rem',
                                              fontWeight: '500',
                                              textAlign: 'left',
                                              cursor: 'pointer',
                                              userSelect: 'none',
                                              transition: 'background 0.2s'
                                            }}
                                            title="Click to sort"
                                          >
                                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                              {col}
                                              {sortConfig.column === i && (
                                                <span style={{ fontSize: '0.7rem' }}>
                                                  {sortConfig.direction === 'asc' ? 'â–²' : 'â–¼'}
                                                </span>
                                              )}
                                            </div>
                                          </th>
                                        ))}
                                      </tr>
                                    </thead>
                                    <tbody>
                                      {sortedRows && sortedRows.map((row, rowIndex) => (
                                        <tr 
                                          key={rowIndex}
                                          style={{
                                            background: rowIndex % 2 === 0 ? '#1a1a1a' : '#151515'
                                          }}
                                        >
                                          {row.map((cell, cellIndex) => (
                                            <td key={cellIndex} style={{
                                              padding: '0.75rem',
                                              borderRight: cellIndex < row.length - 1 ? '1px solid rgba(0, 217, 255, 0.15)' : 'none',
                                              borderBottom: '1px solid rgba(0, 217, 255, 0.1)',
                                              color: 'white',
                                              fontSize: '0.85rem'
                                            }}>
                                              {cell || '-'}
                                            </td>
                                          ))}
                                        </tr>
                                      ))}
                                    </tbody>
                                  </table>
                                </div>
                              );
                            };
                            
                            elements.push(
                              <div key={elements.length} style={{ margin: '1.5rem 0' }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.75rem' }}>
                                  {tableData.name && (
                                    <div style={{ 
                                      fontSize: '0.9rem', 
                                      fontWeight: '500',
                                      color: '#00d9ff'
                                    }}>
                                      ðŸ“Š {tableData.name}
                                    </div>
                                  )}
                                  <button
                                    type="button"
                                    onClick={() => {
                                      // Switch to edit mode with this table pre-loaded
                                      setEditingDocument(viewingDocument);
                                      setViewingDocument(null);
                                    }}
                                    style={{
                                      padding: '0.4rem 0.75rem',
                                      background: 'rgba(0, 217, 255, 0.1)',
                                      border: '1px solid #00d9ff',
                                      borderRadius: '0.25rem',
                                      color: '#00d9ff',
                                      fontSize: '0.75rem',
                                      cursor: 'pointer',
                                      fontWeight: '500'
                                    }}
                                  >
                                    âœï¸ EDIT
                                  </button>
                                </div>
                                <SortableTable data={tableData} />
                              </div>
                            );
                          } catch (e) {
                            console.error('Error parsing table:', e, tableStr);
                            elements.push(
                              <div key={elements.length} style={{ 
                                color: '#ff0055', 
                                fontSize: '0.85rem', 
                                padding: '0.5rem', 
                                background: 'rgba(255,0,85,0.1)', 
                                borderRadius: '0.25rem', 
                                margin: '0.5rem 0' 
                              }}>
                                Error rendering table
                              </div>
                            );
                          }
                          
                          lastIndex = tableEnd;
                          searchIndex = tableEnd;
                        }
                        
                        return elements;
                      })()}
                    </div>
                  </div>

                  <div style={{
                    padding: '1rem',
                    background: 'rgba(0, 255, 136, 0.05)',
                    border: '1px solid rgba(0, 255, 136, 0.2)',
                    borderRadius: '0.375rem',
                    marginBottom: '1.5rem'
                  }}>
                    <div style={{ 
                      display: 'grid',
                      gridTemplateColumns: '1fr 1fr',
                      gap: '1rem',
                      fontSize: '0.85rem'
                    }}>
                      <div>
                        <div style={{ color: 'rgba(255,255,255,0.5)', marginBottom: '0.25rem' }}>
                          Author
                        </div>
                        <div style={{ color: 'white' }}>
                          {viewingDocument.author_name || 'Unknown'}
                        </div>
                      </div>
                      <div>
                        <div style={{ color: 'rgba(255,255,255,0.5)', marginBottom: '0.25rem' }}>
                          Version
                        </div>
                        <div style={{ color: 'white' }}>
                          {viewingDocument.version || '1.0'}
                        </div>
                      </div>
                      <div>
                        <div style={{ color: 'rgba(255,255,255,0.5)', marginBottom: '0.25rem' }}>
                          Created
                        </div>
                        <div style={{ color: 'white' }}>
                          {new Date(viewingDocument.created_at).toLocaleDateString()}
                        </div>
                      </div>
                      <div>
                        <div style={{ color: 'rgba(255,255,255,0.5)', marginBottom: '0.25rem' }}>
                          Last Updated
                        </div>
                        <div style={{ color: 'white' }}>
                          {new Date(viewingDocument.updated_at).toLocaleDateString()}
                        </div>
                      </div>
                    </div>
                  </div>

                  <div style={{ display: 'flex', gap: '0.5rem' }}>
                    <button
                      onClick={() => {
                        setEditingDocument(viewingDocument);
                        setViewingDocument(null);
                      }}
                      style={{
                        flex: 1,
                        padding: '0.75rem',
                        background: 'rgba(0, 217, 255, 0.1)',
                        border: '1px solid #00d9ff',
                        borderRadius: '0.375rem',
                        color: '#00d9ff',
                        cursor: 'pointer',
                        fontWeight: '500'
                      }}
                    >
                      EDIT DOCUMENT
                    </button>
                    <button
                      onClick={() => setViewingDocument(null)}
                      style={{
                        padding: '0.75rem 1.5rem',
                        background: 'transparent',
                        border: '1px solid rgba(255, 255, 255, 0.2)',
                        borderRadius: '0.375rem',
                        color: 'white',
                        cursor: 'pointer'
                      }}
                    >
                      CLOSE
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Edit Document Modal */}
          {editingDocument && (
            <div 
              style={{
                position: 'fixed',
                inset: 0,
                background: 'rgba(0, 0, 0, 0.85)',
                backdropFilter: 'blur(4px)',
                zIndex: 50,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '1rem'
              }}
              onClick={() => setEditingDocument(null)}
            >
              <div 
                style={{
                  background: '#1a1a1a',
                  border: '2px solid #00d9ff',
                  borderRadius: '0.5rem',
                  maxWidth: '600px',
                  width: '100%',
                  maxHeight: '90vh',
                  overflow: 'auto',
                  boxShadow: '0 0 60px rgba(0, 217, 255, 0.4)'
                }}
                onClick={(e) => e.stopPropagation()}
              >
                <div style={{
                  padding: '1.5rem',
                  borderBottom: '1px solid rgba(0, 217, 255, 0.3)',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center'
                }}>
                  <h2 style={{ color: '#00d9ff', fontSize: '1.25rem' }}>EDIT DOCUMENT</h2>
                  <button
                    onClick={() => setEditingDocument(null)}
                    style={{
                      background: 'transparent',
                      border: 'none',
                      color: 'white',
                      fontSize: '1.5rem',
                      cursor: 'pointer',
                      padding: '0.25rem'
                    }}
                  >
                    Ã—
                  </button>
                </div>
                <div style={{ padding: '1.5rem' }}>
                  <DocumentForm 
                    document={editingDocument}
                    onSave={(formData) => handleUpdateDocument(editingDocument.id, formData)}
                    onCancel={() => setEditingDocument(null)}
                  />
                </div>
              </div>
            </div>
          )}

          {/* Create Equipment Modal */}
          {showCreateEquipModal && (
            <div 
              style={{
                position: 'fixed',
                inset: 0,
                background: 'rgba(0, 0, 0, 0.85)',
                backdropFilter: 'blur(4px)',
                zIndex: 50,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '1rem'
              }}
              onClick={() => setShowCreateEquipModal(false)}
            >
              <div 
                style={{
                  background: '#1a1a1a',
                  border: '2px solid #00ff88',
                  borderRadius: '0.5rem',
                  maxWidth: '600px',
                  width: '100%',
                  maxHeight: '90vh',
                  overflow: 'auto',
                  boxShadow: '0 0 60px rgba(0, 255, 136, 0.4)'
                }}
                onClick={(e) => e.stopPropagation()}
              >
                <div style={{
                  padding: '1.5rem',
                  borderBottom: '1px solid rgba(0, 255, 136, 0.3)',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center'
                }}>
                  <h2 style={{ color: '#00ff88', fontSize: '1.25rem' }}>ADD NEW EQUIPMENT</h2>
                  <button
                    onClick={() => setShowCreateEquipModal(false)}
                    style={{
                      background: 'transparent',
                      border: 'none',
                      color: 'white',
                      fontSize: '1.5rem',
                      cursor: 'pointer',
                      padding: '0.25rem'
                    }}
                  >
                    Ã—
                  </button>
                </div>
                <div style={{ padding: '1.5rem' }}>
                  <EquipmentForm 
                    onSave={handleCreateEquipment}
                    onCancel={() => setShowCreateEquipModal(false)}
                  />
                </div>
              </div>
            </div>
          )}

          {/* View Equipment Modal */}
          {viewingEquipment && (
            <div 
              style={{
                position: 'fixed',
                inset: 0,
                background: 'rgba(0, 0, 0, 0.85)',
                backdropFilter: 'blur(4px)',
                zIndex: 50,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '1rem'
              }}
              onClick={() => setViewingEquipment(null)}
            >
              <div 
                style={{
                  background: '#1a1a1a',
                  border: '2px solid #00ff88',
                  borderRadius: '0.5rem',
                  maxWidth: '700px',
                  width: '100%',
                  maxHeight: '90vh',
                  overflow: 'auto',
                  boxShadow: '0 0 60px rgba(0, 255, 136, 0.4)'
                }}
                onClick={(e) => e.stopPropagation()}
              >
                <div style={{
                  padding: '1.5rem',
                  borderBottom: '1px solid rgba(0, 255, 136, 0.3)',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'flex-start'
                }}>
                  <div style={{ flex: 1 }}>
                    <h2 style={{ color: '#00ff88', fontSize: '1.5rem', marginBottom: '0.5rem' }}>
                      {viewingEquipment.name}
                    </h2>
                    <div style={{ display: 'flex', gap: '0.75rem', flexWrap: 'wrap' }}>
                      <div style={{
                        padding: '0.25rem 0.75rem',
                        background: 'rgba(0, 255, 136, 0.1)',
                        border: '1px solid #00ff88',
                        borderRadius: '0.25rem',
                        fontSize: '0.75rem',
                        color: '#00ff88',
                        textTransform: 'uppercase'
                      }}>
                        {viewingEquipment.category_id}
                      </div>
                      <div style={{
                        padding: '0.25rem 0.75rem',
                        background: 
                          viewingEquipment.status === 'operational' ? 'rgba(0, 255, 136, 0.1)' :
                          viewingEquipment.status === 'maintenance' ? 'rgba(255, 234, 0, 0.1)' :
                          'rgba(255, 0, 85, 0.1)',
                        border: `1px solid ${
                          viewingEquipment.status === 'operational' ? '#00ff88' :
                          viewingEquipment.status === 'maintenance' ? '#ffea00' :
                          '#ff0055'
                        }`,
                        borderRadius: '0.25rem',
                        fontSize: '0.75rem',
                        color: 
                          viewingEquipment.status === 'operational' ? '#00ff88' :
                          viewingEquipment.status === 'maintenance' ? '#ffea00' :
                          '#ff0055',
                        textTransform: 'uppercase'
                      }}>
                        {viewingEquipment.status}
                      </div>
                    </div>
                  </div>
                  <button
                    onClick={() => setViewingEquipment(null)}
                    style={{
                      background: 'transparent',
                      border: 'none',
                      color: 'white',
                      fontSize: '1.5rem',
                      cursor: 'pointer',
                      padding: '0.25rem',
                      marginLeft: '1rem'
                    }}
                  >
                    Ã—
                  </button>
                </div>
                <div style={{ padding: '1.5rem' }}>
                  <div style={{
                    padding: '1rem',
                    background: 'rgba(0, 255, 136, 0.05)',
                    border: '1px solid rgba(0, 255, 136, 0.2)',
                    borderRadius: '0.375rem',
                    marginBottom: '1.5rem'
                  }}>
                    <div style={{ 
                      display: 'grid',
                      gridTemplateColumns: '1fr 1fr',
                      gap: '1rem',
                      fontSize: '0.85rem'
                    }}>
                      {viewingEquipment.manufacturer && (
                        <div>
                          <div style={{ color: 'rgba(255,255,255,0.5)', marginBottom: '0.25rem' }}>
                            Manufacturer
                          </div>
                          <div style={{ color: 'white' }}>
                            {viewingEquipment.manufacturer}
                          </div>
                        </div>
                      )}
                      {viewingEquipment.model && (
                        <div>
                          <div style={{ color: 'rgba(255,255,255,0.5)', marginBottom: '0.25rem' }}>
                            Model
                          </div>
                          <div style={{ color: 'white' }}>
                            {viewingEquipment.model}
                          </div>
                        </div>
                      )}
                      {viewingEquipment.serial_number && (
                        <div>
                          <div style={{ color: 'rgba(255,255,255,0.5)', marginBottom: '0.25rem' }}>
                            Serial Number
                          </div>
                          <div style={{ color: 'white' }}>
                            {viewingEquipment.serial_number}
                          </div>
                        </div>
                      )}
                      {viewingEquipment.location && (
                        <div>
                          <div style={{ color: 'rgba(255,255,255,0.5)', marginBottom: '0.25rem' }}>
                            Location
                          </div>
                          <div style={{ color: 'white' }}>
                            {viewingEquipment.location}
                          </div>
                        </div>
                      )}
                    </div>
                  </div>

                  {viewingEquipment.notes && (
                    <div style={{ marginBottom: '1.5rem' }}>
                      <div style={{ 
                        fontSize: '0.85rem', 
                        color: 'rgba(255,255,255,0.5)',
                        marginBottom: '0.5rem',
                        textTransform: 'uppercase',
                        letterSpacing: '1px'
                      }}>
                        Notes
                      </div>
                      <div style={{ 
                        color: 'white',
                        lineHeight: '1.6',
                        whiteSpace: 'pre-wrap'
                      }}>
                        {viewingEquipment.notes}
                      </div>
                    </div>
                  )}

                  <div style={{ display: 'flex', gap: '0.5rem' }}>
                    <button
                      onClick={() => {
                        setEditingEquipment(viewingEquipment);
                        setViewingEquipment(null);
                      }}
                      style={{
                        flex: 1,
                        padding: '0.75rem',
                        background: 'rgba(0, 217, 255, 0.1)',
                        border: '1px solid #00d9ff',
                        borderRadius: '0.375rem',
                        color: '#00d9ff',
                        cursor: 'pointer',
                        fontWeight: '500'
                      }}
                    >
                      EDIT EQUIPMENT
                    </button>
                    <button
                      onClick={() => setViewingEquipment(null)}
                      style={{
                        padding: '0.75rem 1.5rem',
                        background: 'transparent',
                        border: '1px solid rgba(255, 255, 255, 0.2)',
                        borderRadius: '0.375rem',
                        color: 'white',
                        cursor: 'pointer'
                      }}
                    >
                      CLOSE
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Edit Equipment Modal */}
          {editingEquipment && (
            <div 
              style={{
                position: 'fixed',
                inset: 0,
                background: 'rgba(0, 0, 0, 0.85)',
                backdropFilter: 'blur(4px)',
                zIndex: 50,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '1rem'
              }}
              onClick={() => setEditingEquipment(null)}
            >
              <div 
                style={{
                  background: '#1a1a1a',
                  border: '2px solid #00d9ff',
                  borderRadius: '0.5rem',
                  maxWidth: '600px',
                  width: '100%',
                  maxHeight: '90vh',
                  overflow: 'auto',
                  boxShadow: '0 0 60px rgba(0, 217, 255, 0.4)'
                }}
                onClick={(e) => e.stopPropagation()}
              >
                <div style={{
                  padding: '1.5rem',
                  borderBottom: '1px solid rgba(0, 217, 255, 0.3)',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center'
                }}>
                  <h2 style={{ color: '#00d9ff', fontSize: '1.25rem' }}>EDIT EQUIPMENT</h2>
                  <button
                    onClick={() => setEditingEquipment(null)}
                    style={{
                      background: 'transparent',
                      border: 'none',
                      color: 'white',
                      fontSize: '1.5rem',
                      cursor: 'pointer',
                      padding: '0.25rem'
                    }}
                  >
                    Ã—
                  </button>
                </div>
                <div style={{ padding: '1.5rem' }}>
                  <EquipmentForm 
                    equipment={editingEquipment}
                    onSave={(formData) => handleUpdateEquipment(editingEquipment.id, formData)}
                    onCancel={() => setEditingEquipment(null)}
                  />
                </div>
              </div>
            </div>
          )}

          {/* Toast Notification */}
          {toast && (
            <div className="toast">
              <div style={{ fontWeight: '500' }}>{toast.message}</div>
            </div>
          )}
        </div>
      );
    };

    // ==================== APP ROOT ====================
    const App = () => {
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [currentUser, setCurrentUser] = useState(null);
      const [checking, setChecking] = useState(true);

      useEffect(() => {
        // Check if user is already logged in
        const checkAuth = async () => {
          const token = getAuthToken();
          if (token) {
            try {
              const data = await apiRequest('/auth/me');
              if (data.success) {
                setCurrentUser(data.data);
                setIsAuthenticated(true);
              } else {
                removeAuthToken();
              }
            } catch (error) {
              removeAuthToken();
            }
          }
          setChecking(false);
        };
        
        checkAuth();
      }, []);

      const handleLoginSuccess = (user) => {
        setCurrentUser(user);
        setIsAuthenticated(true);
      };

      const handleLogout = () => {
        setCurrentUser(null);
        setIsAuthenticated(false);
      };

      if (checking) {
        return (
          <div style={{
            minHeight: '100vh',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center'
          }}>
            <div className="spinner" style={{ width: '48px', height: '48px' }} />
          </div>
        );
      }

      return isAuthenticated ? (
        <MainApp user={currentUser} onLogout={handleLogout} />
      ) : (
        <LoginPage onLoginSuccess={handleLoginSuccess} />
      );
    };

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
